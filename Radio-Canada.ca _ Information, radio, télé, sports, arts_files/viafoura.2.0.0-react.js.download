/* Fichier 21.27 */
/* Lien web: http://s.radio-canada.ca/_js/pluck/viafoura.js */
/* Lien web: http://s.radio-canada.ca/mp/viafoura.js */

var fichier = "21.27";
var RadioCanada = RadioCanada || {};
RadioCanada.Mod = RadioCanada.Mod || {};
RadioCanada.Lib = RadioCanada.Lib || {};
RadioCanada.Lib.Mod = RadioCanada.Lib.Mod || {};
RadioCanada.Web = RadioCanada.Web || {};

RadioCanada.ViafouraGlobalVars = {};
RadioCanada.ViafouraGlobalVars.ViafouraOnline = true;
RadioCanada.ViafouraGlobalVars.CustomViafouraLocation = "//s.radio-canada.ca/mp/viafouraCustom.css";
RadioCanada.ViafouraGlobalVars.loginbarScriptSrc = '//s.radio-canada.ca/mp/rc.oauth.loginbar-1.0.0.js';
RadioCanada.ViafouraGlobalVars.OAuthClientScriptSrc = '//s.radio-canada.ca/mp/rc.oauth2.client-1.0.0.js';

RadioCanada.Viafoura = function () {
    
    var path = 'http://api.radio-canada.ca/viafoura/v1/api';
    var viafouraApi = 'https://api.viafoura.com/v2/radio-canada.ca/';

    var CommentsClose = false;
    var memberCenterClose = false;

    var ViafouraOnline = true;
    var AutomaticSetup = true;
    var ViafouraSignupPopupCallbackCalled = false;
    var ViafouraLoginPopupCallbackCalled = false;
    var ViafouraSettingsPopupCallbackCalled = false;
    var ModifyCommentsListCalled = false;
    var Instruction = "<a name=\"commenter\" id=\"commenter\"></a><div id=\"commentForm\"><p class=\"txtLegal\"><span class=\"important\">Important</span> Afin de favoriser des discussions riches, respectueuses et constructives, <strong>chaque commentaire soumis sur les tribunes de <a href=\"http://www.radio-canada.ca\">Radio-Canada.ca</a> sera dorénavant signé des nom(s) et prénom(s) de son auteur</strong> (à l'exception de la zone Jeunesse). Le nom d'utilisateur (pseudonyme) ne sera plus affiché.</p><p class=\"txtLegal\">En nous soumettant vos commentaires, vous reconnaissez que Radio-Canada a le droit de les reproduire et de les diffuser, en tout ou en partie et de quelque manière que ce soit. <span>Veuillez noter que Radio-Canada ne cautionne pas les opinions exprimées. Vos commentaires seront modérés, et publiés s'ils respectent la <a href=\"#\" onclick=\"openPopup('http://www.radio-canada.ca/apropos/conditionsutilisation/netiquette/popUp.shtml', 600,500, 'yes'); return false;\">nétiquette</a>. Bonne discussion !</span></p></div>";
    var ShowWelcomeMessage = false;
    var LogFileCall = false;
	var EmailVerified = true;
    var CallbackAfterViafouraReady;
	 var ConfirmationEmailResent = false;

    var J50Npi = {
        currentScript: null,
        getJSON: function (url, data, callback) {
            var src = url + (url.indexOf("?") + 1 ? "&" : "?");
            var head = document.getElementsByTagName("head")[0];
            var newScript = document.createElement("script");
            var params = [];
            var param_name = "";

            this.success = callback;

            //data["callback"] = "RadioCanada.Viafoura.J50Npi.success";
            //data["callback"] = "RadioCanada.Viafoura." + callback;
            data["callback"] = callback;
            for (param_name in data) {
                params.push(param_name + "=" + encodeURIComponent(data[param_name]));
            }
            src += params.join("&");

            newScript.type = "text/javascript";
            newScript.src = src;

            if (this.currentScript) head.removeChild(currentScript);
            head.appendChild(newScript);

        },
        success: null
    };

    var ViafouraUser = {
        id: null,
        comments_made: null,
        name: null,
        email: null,
        user_privilege: null,
        pic_small: null,
        logged: false,
        postingBan: false,
        postingBanReason: ''
    };

    ManualyLoadCommentsWidget = function(callback) {
        var pluckDiv = document.getElementById('pluckComments-0');

        RadioCanada.Viafoura.CallbackAfterViafouraReady = callback;

        if (pluckDiv) {
            var viafouraDiv = GetElementsByClassNameCrossBrowser("viafoura");

            if (!(viafouraDiv && viafouraDiv[0])) {
                pluckDiv.innerHTML = '<div class="viafoura"><div class="vf-comments vf-widget" data-widget="comments" ></div></div>';
            }

            //IncludeViafouraScript();
            RadioCanada.Viafoura.Init();
        }             
    }

    //1
    AddInstructions = function () {
        var widget = GetElementsByClassNameCrossBrowser('viafoura');

        var nouveauteMessage = document.getElementById('viafouraWelcomeMessage');
        if (nouveauteMessage) {
            nouveauteMessage.parentNode.removeChild(nouveauteMessage);
        }

        var instructionDiv = document.getElementById('commentForm');
        if (instructionDiv) {
            instructionDiv.parentNode.removeChild(instructionDiv);
        }

        var nouveaute = '<style> .commentsCloseLink{color: #07428a !important} .commentsCloseLink:hover{color: #07428a !important; text-decoration: underline !important;} .commentsClose{font-family: Arial,Helvetica,sans-serif; line-height: 20px; font-size: 14px;  background-color: #F6F6F6; border: 1px solid #D3D3D3; margin: 10px 0 21px !important; padding: 8px 20px 10px 16px !important} </style>' +
            '<div id="viafouraWelcomeMessage"><img src="//s.radio-canada.ca/_img/logo/logo-nav-radio-canada.gif"><div class="commentsClose" ><strong>Bienvenue dans les nouvelles tribunes d\'ICI Radio-Canada.ca!</strong><br><br>' +
	        'Nous sommes fiers de vous offrir un nouvel environnement où, nous l\'espérons, vous prendrez encore plus de plaisir à commenter, échanger et réagir.<br><br>' +
            'Les nouvelles tribunes d\'ICI Radio-Canada.ca proposent, en plus d\'une nouvelle apparence, des fonctionnalités qui rendront votre expérience encore plus interactive.<br><br>' +
            'Si vous le souhaitez, vous pouvez ajouter un avatar pour illustrer votre profil. Choisissez cet avatar soigneusement car il devra aussi respecter la <a href="#" class="commentsCloseLink" onclick="openPopup(\'http://www.radio-canada.ca/apropos/conditionsutilisation/netiquette/popUp.shtml\', 600,500, \'yes\'); return false;">Nétiquette</a>.<br><br>' +
            'Enfin, vous remarquerez que votre commentaire, aussitôt soumis, s\'affichera dans la tribune alors qu\'il sera en attente de modération. Vous seul pourrez le voir jusqu\'à ce que l\'équipe de modération l\'ait lu. En cas de rejet, vous en serez informé immédiatement.<br><br>' +
            'Autres points à retenir:<br>' +
            '<ul><li>Vos nom d\'usager et mot de passe demeurent inchangés</li>' +
            '<li>Les commentaires publiés ces derniers mois seront transférés graduellement</li>' +
            '<li>La modération des commentaires se fera selon <a href="#" class="commentsCloseLink" onclick="openPopup(\'http://www.radio-canada.ca/apropos/conditionsutilisation/netiquette/popUp.shtml\', 600,500, \'yes\'); return false;">les mêmes règles</a> </li></ul>' +
            'Allez-y! Découvrez votre nouvel espace d\'expression citoyenne. Et prenez quelques instants pour lire la <a href="http://auditoire.radio-canada.ca/index.php?/Knowledgebase/List/Index/23/tribunes" target="_blank">Foire aux questions (FAQ)</a>.<br><br>' +
            'Nous avons hâte de vous lire!<br><br>' +
            'L\'équipe d\'ICI Radio-Canada.ca<br><br></div></div>';

        // 	En développement, mais plus nécessaire. Sert à ajouter une note dans certains articles 
        //if(GetOgURL() == 'http://ici.radio-canada.ca/nouvelles/International/2014/01/09/004-dieudonne-justice-interdiction-spectacles.shtml')
        //{		
        //nouveaute += '<div class="commentsClose" >Le message de Pierre 2</div>';
        //}

        if (widget !== undefined && widget[0] !== undefined) {
            if (ShowWelcomeMessage) {
                widget[0].innerHTML = Instruction + nouveaute + widget[0].innerHTML;
            }
            else {
                widget[0].innerHTML = Instruction + widget[0].innerHTML;
            }
            window.viafoura.reset();
        }
    },

    //2
    AddVfUniqueIdMetaTag = function (metaValue) {
        if (typeof (metaValue) !== "undefined") {
            if (RadioCanada.Viafoura.CheckIfMetaExists("vf:unique_id") === false) {
                RadioCanada.Viafoura.CreateMetaTag("vf:unique_id", metaValue);
            }
        }
    },

    //
    AlertBannedUserModify = function (e) {
        var oldEmail = '';
        var newEmail = '';

        var oldName = '';
        var newName = '';

        var userId = '';
        if (e.email) {
            newEmail = e.email;
        }
        if (e.name) {
            newName = e.name;
        }
        if (RadioCanada.Viafoura.ViafouraUser.email) {
            oldEmail = RadioCanada.Viafoura.ViafouraUser.email;
        }
        if (RadioCanada.Viafoura.ViafouraUser.name) {
            oldName = RadioCanada.Viafoura.ViafouraUser.name;
        }
        if (RadioCanada.Viafoura.ViafouraUser.id) {
            userId = RadioCanada.Viafoura.ViafouraUser.id;
        }

        var apiURL = RadioCanada.Viafoura.path + '/User/LogModification';

        RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { oldEmail: oldEmail, newEmail: newEmail, oldName: oldName, newName: newName, userId: userId }, null);
    },

    //3
    AppendCustomViafouraCss = function () {
        var linkElements = document.getElementsByTagName("link");
        var link;
        var viafouraCssFounded = false;
        for (var i = 0; i < linkElements.length; i++) {
            if (viafouraCssFounded == false) {
                link = linkElements[i];
                if (link.href) {
                    if (link.href.indexOf("viafouraCustom.css") > -1) {
                        viafouraCssFounded = true;
                    }
                }
            }
        }


        if (viafouraCssFounded == false) {
            var stylesheet = document.createElement('link');
            stylesheet.href = RadioCanada.ViafouraGlobalVars.CustomViafouraLocation;
            stylesheet.rel = 'stylesheet';
            stylesheet.type = 'text/css';
            document.getElementsByTagName('head')[0].appendChild(stylesheet);
        }
    },

    //
    BlockBannedUser = function () {        
        var message = '<div class="encadreViafoura">Votre compte est suspendu parce que vous utilisez une fausse identité ou un avatar inapproprié, ce qui contrevient à la <a class="lienNetiquette" href="#" onclick="openPopup(\'http://www.radio-canada.ca/apropos/conditionsutilisation/netiquette/popUp.shtml\', 600,500, \'yes\'); return false;">nétiquette</a>.<br><br>';
        message += 'Veuillez <a href="https://ici.radio-canada.ca/mon-espace" class="lienParametres">cliquer ici</a> pour modifier vos paramètres.<br><br>';
        message += 'Votre compte sera réactivé dans un délai maximal de 24 heures après la validation de votre identité.<br><br>';
        message += 'L\'équipe d\'ICI.Radio-canada.ca</div>';

        var comment = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-comment-form');
        
        if (RadioCanada.Viafoura.ViafouraUser.postingBan) {
            if (comment[0].innerHTML != message)
            {
                comment[0].innerHTML = message;
            }
            
            //Retrait des boutons "Répondre" dans les commentaires
            var btnsRepondre = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-reply-btn');

            if (btnsRepondre !== undefined) {
                for (var i = 0; i < btnsRepondre.length; i++) {
                    btnsRepondre[i].style.display = "none";
                }
            }
        }      
    },
	
	ResendConfirmationEmail = function()
	{
		//var token = rcOAuth2Client.getAccessToken();
        var token = window.loginApi.getAccessToken();
		
		var ProfilageApi = 'https://services.radio-canada.ca/id/v3/';
		apiURL = ProfilageApi + 'auth/resend-confirmation-email?access_token=' + token;
					
		var data = '';
		
		/*
		$.ajax({
			type: "POST",
			url: apiURL,
			data: data,
			success: function()
			{
				RadioCanada.Viafoura.ConfirmationEmailResent = true;
			}
		});			
		*/
		
		jQuery.ajax({
			url: ProfilageApi + 'auth/resend-confirmation-email?access_token=' + token,
			type: 'POST',
			data: data,
			crossDomain: true,
			contentType: "application/json",
			success: function (data) {
				RadioCanada.Viafoura.ConfirmationEmailResent = true;
			},
			error: function (data) {
				console.log('Une erreur est survenue lors du chargement de la page. Veuillez réessayer');
			}
		});
	},
	
	BlockUnverifiedUser = function()
	{
					
		var message = '<div class="encadreViafoura">Votre adresse courriel n\'est pas validée.<br><br>';
		message += 'Un courriel de validation vous a déjà été envoyé afin d\'activer votre compte. Veuillez vérifier vos courriels.<br><br>';
		message += 'Veuillez <a href="#" onclick="RadioCanada.Viafoura.ResendConfirmationEmail()" class="lienParametres">cliquer ici</a> pour renvoyer un courriel de validation<br><br>';        
		
        if(RadioCanada.Viafoura.ConfirmationEmailResent)
		{
			message += '<strong>Un courriel de validation a été envoyé à l\'adresse ' + RadioCanada.Viafoura.ViafouraUser.email + '</strong><br><br>';
		}
		
		message += '<div id="resultResendConfirmationEmail"></div>';
        message += 'L\'équipe d\'ICI.Radio-canada.ca</div>';

        var comment = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-comment-form');
        
        if(!RadioCanada.Viafoura.EmailVerified)		
		{
            if (comment[0].innerHTML != message)
            {
                comment[0].innerHTML = message;
            }
            
            //Retrait des boutons "Répondre" dans les commentaires
            var btnsRepondre = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-reply-btn');

            if (btnsRepondre !== undefined) {
                for (var i = 0; i < btnsRepondre.length; i++) {
                    btnsRepondre[i].style.display = "none";
                }
            }
        }     
		
		
	},
		
    
    //4    
    BunkerNavBarLogOn = function () {        
        window.viafoura.ui.login.show();        
    },

    //5    
	BunkerNavBarLogOut = function (automaticLogout) {	    
	    window.viafoura.session.logout();

	    if (typeof automaticLogout !== 'undefined')
	    {
	        if(automaticLogout)
	        {
	            //rcOAuth2Client.login();
                window.loginApi.login();
	        }
	    }
	},

    //6    
    ChangeLabel = function (className, oldText, newText) {
        var container = GetElementsByClassNameCrossBrowser(className);
        var containerIndex = 0;

        if (container !== undefined) {
            while (container[containerIndex] !== undefined) {
                if (oldText == '' || container[containerIndex].innerHTML == oldText) {
                    container[containerIndex].innerHTML = newText;
                }
                containerIndex++;
            }
        }
    },

    //7    
    CheckIfMetaExists = function (propertyname) {
        var metaTagFounded = false;
        var propertyAttr;
        if (typeof (propertyname) !== "undefined") {
            var metaElements = document.getElementsByTagName("meta");
            var meta;
            for (var i = 0; i < metaElements.length; i++) {
                if (metaTagFounded == false) {
                    meta = metaElements[i];
                    propertyAttr = meta.getAttribute("property");
                    if (propertyAttr) {
                        if (propertyAttr.indexOf(propertyname) > -1) {
                            metaTagFounded = true;
                        }
                    }
                }
            }
        }
        return metaTagFounded;
    },

    //8    
    CheckIfViafouraScriptIsIncluded = function (scriptName) {
        var linkElements = document.getElementsByTagName("script");
        var link;
        var viafouraScriptFounded = false;
        for (var i = 0; i < linkElements.length; i++) {
            if (viafouraScriptFounded == false) {
                link = linkElements[i];
                if (link.src) {
                    if (link.src.indexOf(scriptName) > -1) {
                        viafouraScriptFounded = true;
                    }
                }
            }
        }
        return viafouraScriptFounded;

    },

    //9    
    CreateMetaTag = function (property, content) {
        var metatag = document.createElement('meta');
        metatag.setAttribute("content", content);
        metatag.setAttribute("property", property);
        document.getElementsByTagName('head')[0].appendChild(metatag);
    },

    //10    
    ContentMonProfil = function (cpt) {
        if (!cpt)
        {
            cpt = 0;
        }
        var name = '';

        if (RadioCanada.Viafoura.ViafouraUser.logged) {
            name = RadioCanada.Viafoura.ViafouraUser.name;
        }

        var MonProfil = document.getElementById('monProfilSSO'),
		    html = "";

        if (RadioCanada.Viafoura.ViafouraUser.logged) {
            html += '<!-- Version connecte  -->';
            html += '<h1 class="profil_connecte"><span>Mon profil</span></h1>';
            html += ' <div class="blocContenu blocDemi">';
            html += '   <h2>Bonjour ' + name + '</h2>';
            html += '   <p class="source">Vous &ecirc;tes actuellement connect&eacute; au site de Radio-Canada.ca.</p>';
            html += '  	<p>Si vous souhaitez fermer votre session, vous pouvez le faire en cliquant sur le bouton suivant. Vous pouvez aussi le faire en tout temps en cliquant sur l&rsquo;ic&ocirc;ne <img class="img_connection" src="/mesAbonnements/lib/v3.1/img/bt_deconnection.gif" alt="Visuel de l&rsquo;ic&ocirc;ne «Fermer une session» se retrouvant dans la barre de navigation." title="Visuel de l&rsquo;ic&ocirc;ne «Fermer une session» se retrouvant dans la barre de navigation." /> dans la barre de navigation du haut, &agrave; droite.</p>';
            html += '    <a href="#" onclick="window.viafoura.session.logout(); statsToClics(\'clic_action\',\'NavBar_Rouge_SeDeconnecter\',\'clic_contenu\',\'NavBar_Rouge_SeDeconnecter\',\'WT.ti\',\'NavBar_Rouge_SeDeconnecter\'); return false;" class="se_deconnecter"><span>Fermer une session</span></a>';
            html += ' </div>';
            html += ' <div class="blocContenu blocDemi">';
            html += '    <p>Si vous souhaitez modifier vos informations personnelles, cliquez sur le bouton suivant;';
            html += '    Vous pouvez aussi avoir acc&egrave;s directement &agrave; votre profil en cliquant sur votre nom dans la barre de navigation du haut, &agrave; droite. </p>';
            html += '    <a href="#" onclick="window.viafoura.ui.profile.show(); return false;" class="modif_profil"><span>Modifier mon profil</span></a>';
            html += '    <p>Si vous souhaitez consulter les commentaires que vous avez laiss&eacute;s, cliquez sur le bouton suivant. Vous pouvez aussi activer l&rsquo;option Facebook, qui permet de publier vos commentaires de Radio-Canada.ca sur votre profil personnel Facebook.</p>';
            html += '    <a href="#" onclick="window.viafoura.ui.profile.show(); return false;" class="vos_commentaires"><span>Mes commentaires</span></a>';
            html += ' </div>';
            html += ' <!-- Fin Version connecte --> ';
        }
        else {
            html += '<!-- Version deconnecte ou non inscrit  -->';
            html += '<h1 class="profil"><span>Mon profil</span></h1>';
            html += '  <div class="blocContenu blocIntro">';
            html += '  <p>Bonjour,<br />';
            html += '  En tant que membre de Radio-Canada.ca, vous pouvez en tout temps exprimer vos commentaires et partager votre opinion sur le site, recevoir nos cyberlettres et participer &agrave; nos activit&eacute;s interactives.</p>';
            html += '  </div>';
            html += '  <div class="blocContenu blocDemi">';
            html += '   	<h2>Vous avez d&eacute;j&agrave; un compte?</h2>';
            html += '     <p class="source">Vous n&rsquo;&ecirc;tes pas connect&eacute; au site de Radio-Canada.ca.</p>';
            html += ' 		<p>Si vous poss&eacute;dez un compte et que vous souhaitez y acc&eacute;der, cliquez sur le bouton suivant. Vous pouvez aussi le faire en tout temps en cliquant sur l&rsquo;ic&ocirc;ne <img class="img_connection" src="/mesAbonnements/lib/v3.1/img/bt_connection.gif" alt="Visuel de l&rsquo;ic&ocirc;ne «Ouvrir une session» se retrouvant dans la barre de navigation." title="Visuel de l&rsquo;ic&ocirc;ne «Ouvrir une session» se retrouvant dans la barre de navigation." /> dans la barre de navigation du haut, &agrave; droite.</p>';
            html += '	  <a href="#" onclick="window.viafoura.ui.login.show(); statsToClics(\'clic_action\',\'NavBar_Rouge_SeConnecter\',\'clic_contenu\',\'NavBar_Rouge_SeConnecter\',\'WT.ti\',\'NavBar_Rouge_SeConnecter\'); return false;" class="se_connecter"><span>Ouvrir une session</span></a>';
            html += '   </div>';
            html += '	<div class="blocContenu blocDemi">';
            html += '   	<h2>Vous n&rsquo;avez pas de compte?</h2>';
            html += '       <p>Si vous ne poss&eacute;dez pas de compte sur Radio-Canada.ca, cr&eacute;ez-en un en cliquant sur ce bouton. C&rsquo;est simple et rapide, vous n&rsquo;avez besoin que d&rsquo;une adresse courriel et de vous choisir un nom d&rsquo;utilisateur et un mot de passe. Vous pourrez y voir les commentaires que vous avez laiss&eacute;s sur le site, choisir vos abonnements aux diverses cyberlettres de Radio-Canada.ca et bien plus encore. </p>';
            html += '   	<a href="#" onclick="window.viafoura.ui.signup.show(); return false;" class="inscrivez_vous"><span>Cr&eacute;er un compte</span></a>';
            html += '       <p>Une fois votre compte cr&eacute;&eacute;, vous pourrez utiliser l&rsquo;ic&ocirc;ne <img class="img_connection" src="/mesAbonnements/lib/v3.1/img/bt_connection.gif" alt="Visuel de l&rsquo;ic&ocirc;ne «Ouvrir une session» se retrouvant dans la barre de navigation." title="Visuel de l&rsquo;ic&ocirc;ne «Ouvrir une session» se retrouvant dans la barre de navigation." /> dans la barre de navigation du haut, &agrave; droite, pour acc&eacute;der &agrave; votre compte ou l&rsquo;ic&ocirc;ne <img class="img_connection" src="/mesAbonnements/lib/v3.1/img/bt_deconnection.gif" alt="Visuel de l&rsquo;ic&ocirc;ne «Fermer une session» se retrouvant dans la barre de navigation." title="Visuel de l&rsquo;ic&ocirc;ne «Fermer une session» se retrouvant dans la barre de navigation." /> pour en sortir. Vous pourrez aussi cliquer sur votre nom, &agrave; gauche de l&rsquo;ic&ocirc;ne, pour acc&eacute;der directement &agrave; votre profil.</p>';
            html += ' 	</div>';
            html += '<!-- Fin Version deconnecte ou non inscrit -->';
        }

        MonProfil.innerHTML = html;
		
		if(cpt<5 && !RadioCanada.Viafoura.ViafouraUser.logged) 
		{
			setTimeout(function () {
					cpt++;					
                    ContentMonProfil(cpt);
			}, 500);
			
		}
    }

    //11    
    DeleteCookie = function (cookieName) {

        if (typeof (cookieName) === "undefined") {
            name = 'acceptSignedComments';
        }
        else {
            name = cookieName;
        }

        var path = '/';
        domain = 'radio-canada.ca'
        secondes = 24 * 60 * 60 * 1000 * 14; //2 semaines

        var today = new Date();
        today.setTime(today.getTime());
        var expires = new Date(today.getTime() - (secondes));
        var secure = "";

        document.cookie = name + "=" + "" +
		((expires) ? ";expires=" + expires.toGMTString() : "") +
		((path) ? ";path=" + path : "") +
		((domain) ? ";domain=" + domain : "") +
		((secure) ? ";secure" : "");
    }

    //12    
    DeleteOptionWithValue = function (optionValue) {


        if (typeof (optionValue) !== "undefined") {
            var optionsToDelete = null;
            var attrValue;

            var options = document.getElementsByTagName("option");
            if (options && options.length > 0) {

                for (var i = 0; i < options.length; i++) {


                    attrValue = options[i].getAttribute("value");
                    if (attrValue && attrValue.indexOf(optionValue) > -1) {
                        optionsToDelete = options[i];
                    }
                }

                if (optionsToDelete != null) {
                    optionsToDelete.parentNode.removeChild(optionsToDelete);
                }
            }
        }

    },

    //13    
	DrawMonProfil = function () {
	    var HTMLBlock = document.getElementById('SSOMonProfil');
	    if (HTMLBlock) {
	        var output = '';
	        output += '<div id="monProfilSSO">';
	        output += '	<a href="https://inscription.radio-canada.ca/SSOAuthenticationDomain.ashx?mode=login&redirecturl=' + window.location + '" class="ouvrir">Ouvrir une session</a>';
	        output += '	<div class="src_login">';
	        output += '		<a href="https://inscription.radio-canada.ca/SSOAuthenticationDomain.ashx?mode=login&redirecturl=' + window.location + '" class="signIn">Ouvrir une session</a>';
	        output += '	</div>';
	        output += '</div>';
	        HTMLBlock.innerHTML = output;
	    }
	}

    //14    
    GetElementsByClassNameCrossBrowser = function (selector) {
        var element;
        if (typeof (selector) === "string") {
            if (typeof (document.getElementsByClassName) !== "undefined") {
                element = document.getElementsByClassName(selector);
                if (element && element[0]) {
                    //element = element[0];
                } else {
                    element = undefined;
                }
            } else {
                // POUR IE 8
                element = document.querySelectorAll("." + selector);
                if (element && element[0]) {
                    //element = element[0];
                } else {
                    element = undefined;
                }
            }
        }
        return element;
    },

    //15    
    GetElementsByClassNameCrossBrowserScope = function (scope, selector) {
        var element;
        if (typeof (selector) === "string") {
            if (typeof (scope.getElementsByClassName) !== "undefined") {
                element = scope.getElementsByClassName(selector);
                if (element && element[0]) {
                    //element = element[0];
                } else {
                    element = undefined;
                }
            } else {
                // POUR IE 8
                element = scope.querySelectorAll("." + selector);
                if (element && element[0]) {
                    //element = element[0];
                } else {
                    element = undefined;
                }
            }
        }
        return element;
    },

    //16    
    GetOgURL = function () {
        var metas = document.getElementsByTagName('meta');

        for (i = 0; i < metas.length; i++) {
            if (metas[i].getAttribute("property") == "og:url") {
                return metas[i].getAttribute("content");
            }
        }

        return "";
    },

    //17    
    GetQueryString = function (qString, stringToParse) {
        if (typeof (stringToParse) === "undefined") {
            hu = window.location.search.substring(1);
        }
        else {
            hu = stringToParse;
        }
        gy = hu.split("&");
        for (i = 0; i < gy.length; i++) {
            ft = gy[i].split("=");
            if (ft[0] == qString) {
                return ft[1];
            }
        }
    },

    //18    
    Get_Cookie = function (c_name) {
        var i, x, y, ARRcookies = document.cookie.split(";");
        for (i = 0; i < ARRcookies.length; i++) {
            x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("="));
            y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1);
            x = x.replace(/^\s+|\s+$/g, "");
            if (x == c_name) {
                return unescape(y);
            }
        }
    },

    //19    
    IncludeCustomViafouraCss = function () {
        if (!RadioCanada.Viafoura.ViafouraOnline) {
            AppendCustomViafouraCss();
        } else {
            var linkElements = document.getElementsByTagName("link");
            var link;
            var viafouraFounded = false;
            for (var i = 0; i < linkElements.length; i++) {
                if (viafouraFounded == false) {
                    link = linkElements[i];
                    if (link.href) {
                        if (link.href.indexOf("viafoura.css") > -1) {
                            viafouraFounded = true;
                            RadioCanada.Viafoura.AppendCustomViafouraCss();
                        }
                    }
                }
            }


            if (viafouraFounded == false) {
                setTimeout(function () {
                    RadioCanada.Viafoura.IncludeCustomViafouraCss();
                }, 1000);
            }
        }
    },

    //20    
    IncludeViafouraScript = function () {

        var vfScriptSrc;

        var session = Get_Cookie("VfSess");

        if (session != undefined) {

            var userid = RadioCanada.Viafoura.ViafouraUser.id;

            if (document.getElementById('viafoura-platform') == undefined) {

                if (RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('viafoura') != undefined && RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('viafoura')[0] != undefined) {
                    var viafoura = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('viafoura')[0];
                                                
                
                    var insertdiv = document.createElement('script');
                    insertdiv.id = 'viafoura-platform';                    

                    viafoura.parentNode.insertBefore(insertdiv, viafoura.nextSibling);                
                }
            }

            if (document.getElementById('viafoura-platform') != undefined) {
                document.getElementById('viafoura-platform').setAttribute("data-sid", session);
                document.getElementById('viafoura-platform').setAttribute("data-uid", userid);
            }
        }


        if (RadioCanada.Viafoura.ViafouraOnline) {
            vfScriptSrc = "cdn.viafoura.net/vf.js";
            RadioCanada.ViafouraGlobalVars.ViafouraScriptSrc = '//cdn.viafoura.net/vf.js';
            //vfScriptSelector = jQuery('script[src*="uat.viafoura.com/app/js/vf.js"]');
            //RadioCanada.ViafouraGlobalVars.ViafouraScriptSrc = '//uat.viafoura.com/app/js/vf.js';
            //vfScriptSelector = jQuery('script[src*="vanjos.whothaman.com/app/js/vf.js"]');
            //RadioCanada.ViafouraGlobalVars.ViafouraScriptSrc = '//vanjos.whothaman.com/app/js/vf.js';

        } else {
            vfScriptSrc = "uat.viafoura.com/app/js/vf.js";
            RadioCanada.ViafouraGlobalVars.ViafouraScriptSrc = '//uat.viafoura.com/app/js/vf.js';
        }

        if (RadioCanada.Viafoura.CheckIfViafouraScriptIsIncluded(vfScriptSrc) == false) {
            (function (v, s) {
                v.type = 'text/javascript';
                v.async = !0;
                v.src = RadioCanada.ViafouraGlobalVars.ViafouraScriptSrc;
                s.parentNode.insertBefore(v, s);
            }(document.createElement('script'), document.getElementsByTagName('script')[0]));
        }
    },
    
    //21   
    Init = function () {
        if (CommentsClose) {
            ShowCommentsClose('viafoura');
        }
        else {
            RadioCanada.Viafoura.IncludeViafouraScript();

            var loadInterval = setInterval(function () {                
                if (window.viafoura) {                    
					RadioCanada.Viafoura.IncludeCustomViafouraCss();
                    clearInterval(loadInterval);
                    InitEvents();
                }

                return;
            }, 100);            
        }        
    },

    //22
    InitCallback = function (resultat) {     
        SetUserInfo(resultat);

        RadioCanada.Viafoura.ViafouraUser.id = resultat.result.id;

        LogCall(fichier);

        if (ViafouraOnline) {
            ModifyViafouraWidget();
        }

        WriteLoginStatus();        
		
		LoadNewsletter();
    },

    GetUpakneeUserId = function (email) {
        var callBackFunction = 'GetUpakneeUserIdCallback';
        var apiURL = RadioCanada.Viafoura.path + '/Cyberlettre';
        var source = 'src';
        var langue = 'fr';
        RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { action: "getUser", email: email, source: source, langue: langue, mailingLists: "", fctCallback: callBackFunction }, callBackFunction);
    }

    GetUpakneeUserIdCallback = function (resultat) {

    }

    UpdateUpakneeUser = function (e) {
        var oldEmail = '';
        var newEmail = '';

        var oldName = '';
        var newName = '';

        var userId = '';
        if (e.email) {
            newEmail = e.email;
        }
        if (e.name) {
            newName = e.name;
        }
        if (RadioCanada.Viafoura.ViafouraUser.email) {
            oldEmail = RadioCanada.Viafoura.ViafouraUser.email;
        }
        if (RadioCanada.Viafoura.ViafouraUser.name) {
            oldName = RadioCanada.Viafoura.ViafouraUser.name;
        }
        if (RadioCanada.Viafoura.ViafouraUser.id) {
            userId = RadioCanada.Viafoura.ViafouraUser.id;
        }

        var callBackFunction = 'UpdateUpakneeUserCallback';
        var apiURL = RadioCanada.Viafoura.path + '/Cyberlettre';
        var source = 'src';
        var langue = 'fr';

        if (newEmail && newEmail != '') {
            var email = "{\"oldEmail\":\"" + oldEmail + "\",\"newEmail\":\"" + newEmail + "\"}";

            RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { action: "updateUser", email: email, source: source, langue: langue, mailingLists: "", fctCallback: callBackFunction }, callBackFunction);
        }
    }

    UpdateUpakneeUserCallback = function (resultat) {

    }

    //23   
    InitEvents = function () {
        window.viafoura.subscribe("onLoginSuccess", function (e) {
            LogIn();
        });

        window.viafoura.subscribe("onLogoutSuccess", function (e) {
            RadioCanada.Viafoura.ViafouraUser.logged = false;
            Init();
            LogOut();
        });

        window.viafoura.subscribe("onUserChange", function (e) {
            // TODO: Upaknee notification here.
            UpdateUpakneeUser(e);

	        if(RadioCanada.Viafoura.ViafouraUser.postingBan)
	        {
	            AlertBannedUserModify(e);
	        }
	    });

        window.viafoura.ready(function (e) {            
            AddInstructions();
            
            if (ConnectionWithLayer7()) {

                VerifyCommentsListLoaded(function () {
                    ModifyCommentsList();
                });
            }
            else
            {
                ModifyCommentsList();
            }

            WriteLoginStatus();

            
            var session_id = '';
            var apiURL = '';
            
            if (typeof RadioCanada.Viafoura.CallbackAfterViafouraReady === 'function')
            {
                RadioCanada.Viafoura.CallbackAfterViafouraReady();
            }

            window.loginApi.getUserInfo().then(function (userInfo) {
                if (userInfo.connected) {
                    getUserInfoDone(200, userInfo);
                }
                else {
                    getUserInfoFail();
                }


            });

            /*
            //Valider la connexion au centre des membre            
            rcOAuth2Client.getUserInfo({
                forceRefresh: true,
                //done: SetUserInfo(resultat),
                done: getUserInfoDone,
                fail: getUserInfoFail
            });
            */
        });      
    },

    getUserInfoFail = function () {        
        RadioCanada.Viafoura.ViafouraUser.logged = false;
		
		session_id = window.viafoura.session.current().id;
		apiURL = viafouraApi + 'users/current?session=' + session_id + '&cacheBuster=' + Math.random();

		cookieName = 'RC_Omniture';		
		DeleteCookie(cookieName);

		var callBackFunction = 'InitCallback';
		RadioCanada.Viafoura.J50Npi.getJSON(apiURL, {}, callBackFunction);            
    },

    getUserInfoDone = function (status, resultat) {        
        if (status == 200) {
            //Connecté au centre des membres            
            RadioCanada.Viafoura.ViafouraUser.logged = true;
			RadioCanada.Viafoura.EmailVerified = resultat.email_verified;

            session_id = Get_Cookie("VfSess");
            apiURL = viafouraApi + 'users/current?session=' + session_id + '&cacheBuster=' + Math.random();

            var callBackFunction = 'InitCallback';
            RadioCanada.Viafoura.J50Npi.getJSON(apiURL, {}, callBackFunction);

            cookieName = 'RC_Omniture';
            cookieValue = resultat.rcid;
            Set_Cookie(cookieName, cookieValue);					
        }
        else {
            //Pas de connexion au centre des membres
            RadioCanada.Viafoura.ViafouraUser.logged = false;
        }        
    },

    //24    
    LoadScript = function (url, callback) {
        // Adding the script tag to the head as suggested before
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = url;

        // Then bind the event to the callback function.
        // There are several events for cross browser compatibility.
        script.onreadystatechange = callback;
        script.onload = callback;

        // Fire the loading
        head.appendChild(script);
    }

    //25    
    LogCall = function (fichier) {
        if (LogFileCall) {
            var apiURL = RadioCanada.Viafoura.path + '/Log';
            var lien = window.location;

            RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { Fichier: fichier, Lien: lien }, null);
        }
    },

    LoginDoneFromLoginBar = function() {
        
    },

    LogoutDoneFromLoginBar = function() {
        
    },

    //26   
    LogIn = function () {
        GetUpakneeUserId(viafoura.users.current().email);

        Reload();

        if (typeof (LoginExternalCallback) == 'function') {
            LoginExternalCallback();
        }
    },

    //27    
    LoadNewsletter = function () {        
        if (document.getElementById('offline_customer') != null) {
            if (RadioCanada.Viafoura.ViafouraUser.logged) {
                ShowNewsLetter();
            }
            else {
                RadioCanada.Viafoura.ShowLoginForm();
            }
        }

    },

    //28    
    LogOut = function () {
        if (typeof (LogoutExternalCallback) == 'function') {
            LogoutExternalCallback();
        }
    },

    LogOutLayer7 = function()
    {
        rcOAuth2Client.logout(
            function () {                
                //rcOAuth2Client.login();
                window.loginApi.login();
            }
            );        
    },
    
    LoadWidget = function() {
        var session = Get_Cookie("VfSess");

        if (session != undefined) {
                                    
            userid = RadioCanada.Viafoura.ViafouraUser.id;

            if (document.getElementById('viafoura-platform') != undefined) {
                document.getElementById('viafoura-platform').setAttribute("data-sid", session);
                document.getElementById('viafoura-platform').setAttribute("data-uid", userid);
            }
        }

        (function (v, s) {
            v.type = 'text/javascript';
            v.async = !0;
            v.src = '//cdn.viafoura.net/vf.js';
            v.id = "ViafouraScript";
            s.parentNode.insertBefore(v, s);
        }(document.createElement('script'), document.getElementsByTagName('script')[0]));
    },
    
    //29
    ModidyCommentAdminOptions = function () {
		/* Ne pas réactiver, bug sur Mac
        var commentAdminOption = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-thread-option');

		
        if (commentAdminOption !== undefined && commentAdminOption[0] !== undefined) {
            ReplaceCommentSectionOption(commentAdminOption, 0, "Utiliser les paramètres par défaut du site");
            ReplaceCommentSectionOption(commentAdminOption, 1, "Toujours prémodérer cette page et ignorer l'expiration de cette page");
            ReplaceCommentSectionOption(commentAdminOption, 2, "Les commentaires sont fermés sur cette page");
            ReplaceCommentSectionOption(commentAdminOption, 3, "Désactiver et cacher les commentaires sur cette page");
            ReplaceCommentSectionOption(commentAdminOption, 4, "Publier les commentaires sans modération et ignorer l'expiration de cette page");
            ReplaceCommentSectionOption(commentAdminOption, 5, "Modérer jusqu'à l'expiration de cette page");
            ReplaceCommentSectionOption(commentAdminOption, 6, "Publier les commentaires sans modération jusqu'à l'expiration de cette page");
        }
		*/
    },

    ConnectionWithLayer7 = function()
    {
        /*
        var debugMode = getParameterByName("debugMode");
        if (debugMode == "true")
        { */           
        return true;
        /*
        }
        else
        {
            return false;
        } */       
    }

    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    //30
    ModifyCommentBox = function () {
        var commentBox = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-content');
        
        if (ConnectionWithLayer7()) {            
		    ShowMessageToLog();        
        } 
        
        BlockBannedUser();
		//BlockUnverifiedUser();
		
		
        if (commentBox !== undefined && commentBox[0] !== undefined) {
            commentBox[0].setAttribute('placeholder', 'Écrire un commentaire ici');
        }               
    },

    //31
    ModifyCommentsList = function () {
        var elements = GetElementsByClassNameCrossBrowser('vf-twitter-tweet');

        if (elements !== undefined) {
            for (var i = elements.length - 1; i >= 0; i--) {
                elements[i].href = elements[i].href.replace('Check%20out%20this%20comment', 'Partage d\'un commentaire');
                elements[i].href = elements[i].href.replace('Check out this comment', 'Partage d\'un commentaire: ');
            }
        }

        var elementsWidget = GetElementsByClassNameCrossBrowser('vf-commenting');

        if (elementsWidget !== undefined) {

            var childElements = elementsWidget[0].children;
            var temp = 'allo';

            for (var i = childElements.length - 1; i >= 0; i--) {
                if (childElements[i].innerHTML == '<strong>Les commentaires sont fermés</strong>') {
                    childElements[i].innerHTML = '<strong>Cette tribune de commentaires est fermée</strong>';
                }
            }

        }

        var modLabels = GetElementsByClassNameCrossBrowser('vf-moderator');

        if (modLabels !== undefined) {
            for (var i = modLabels.length - 1; i >= 0; i--) {
                modLabels[i].innerHTML = 'Modérateur';
            }
        }

        var likes = GetElementsByClassNameCrossBrowser('vf-likes');
        var LikesDiv = '';
        var nbLike = '';
        if (likes !== undefined) {
            for (var i = likes.length - 1; i >= 0; i--) {

                LikesDiv = GetElementsByClassNameCrossBrowserScope(likes[i], 'vf-count-likes');
                if (LikesDiv !== undefined && LikesDiv[0] !== undefined) {
                    nbLike = LikesDiv[0].innerHTML;

                    if (nbLike == "0" || nbLike == "1") {
                        likes[i].innerHTML = '<span class="vf-count-likes">' + nbLike + '</span> personne aime ce commentaire';
                    }
                    else {
                        likes[i].innerHTML = '<span class="vf-count-likes">' + nbLike + '</span> personnes aiment ce commentaire';
                    }
                }
            }
        }

        var moreReply = GetElementsByClassNameCrossBrowser('vf-replies-button');
        var moreReplyDiv = '';
        var nbReply = '';
        if (moreReply !== undefined) {
            for (var i = moreReply.length - 1; i >= 0; i--) {

                moreReplyDiv = GetElementsByClassNameCrossBrowserScope(moreReply[i], 'vf-replies');
                if (moreReplyDiv !== undefined && moreReplyDiv[0] !== undefined) {
                    nbReply = moreReplyDiv[0].innerHTML;

                    if (nbReply == "0" || nbReply == "1") {
                        moreReply[i].innerHTML = 'Afficher <span class="vf-replies">' + nbReply + '</span> autre réponse';
                    }
                    else {
                        moreReply[i].innerHTML = 'Afficher <span class="vf-replies">' + nbReply + '</span> autres réponses';
                    }
                }
            }
        }

        var trustedUsers = GetElementsByClassNameCrossBrowser('vf-trusted');
        if (trustedUsers !== undefined) {
            for (var i = trustedUsers.length - 1; i >= 0; i--) {
                trustedUsers[i].innerHTML = 'Usager de confiance';
            }
        }

        ModifyCommentsOptions();
    }

    //32
    ModifySortCommentOptions = function () {
        /* Ne pas réactiver, bug sur Mac
        RadioCanada.Viafoura.DeleteOptionWithValue("editor_picks");

        var commentOption = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-comments-sort');

        if (commentOption !== undefined && commentOption[0] !== undefined) {
            ReplaceCommentSectionOption(commentOption, 0, "Les plus récents");
            ReplaceCommentSectionOption(commentOption, 1, "Les plus anciens");
            ReplaceCommentSectionOption(commentOption, 2, "Les plus aimés");
            ReplaceCommentSectionOption(commentOption, 3, "Les plus actifs");
            ReplaceCommentSectionOption(commentOption, 4, "Le plus de réponses");
        }
        */
    },

    //33
    ModifyCommentsOptions = function () {

        ModidyCommentAdminOptions();
        ModifySortCommentOptions();
        ModifyCommentBox();

        ChangeLabel('vf-logout', 'DÃ©connexion', 'Déconnexion');
        ChangeLabel('vf-approve-btn', 'Approuver cet Ã©lÃ©ment', 'Approuver cet élément');
        ChangeLabel('vf-pick-btn', 'Faire sÃ©lection de l\'Ã©diteur', 'Faire sélection de l\'éditeur');
        ChangeLabel('vf-error-message', 'Ne peut pas Ãªtre vide', 'Ne peut pas être vide');
        ChangeLabel('vf-disabled-content vf-alert', 'Contenu dÃ©sactivÃ©', 'Contenu désactivé');
        ChangeLabel('vf-spam vf-alert', 'MarquÃ© comme pourriel', 'Marqué comme pourriel');
        ChangeLabel('vf-reply-btn', 'RÃ©pondre', 'Répondre');
        ChangeLabel('vf-info vf-alert', 'En attente de modÃ©ration...', 'En attente de modération...');
        ChangeLabel('vf-disable-btn', 'DÃ©sactiver cet Ã©lÃ©ment', 'Désactiver cet élément');
        ChangeLabel('vf-no-messages', 'There are no comments yet.', '');

        ChangeLabel('vf-flag', 'SignalÃ©', 'Signalé');
        ModifyLoginWindow();
    },

    //34
    ModifyLoginWindow = function () {
        ChangeLabel('vf-link vf-signup', 'CrÃ©er un compte', 'Créer un compte');
        ChangeLabel('vf-modal-title', 'Mot de passe oubliÃ©?:', 'Mot de passe oublié?:');
        ChangeLabel('vf-modal-title', 'CrÃ©er un compte:', 'Créer un compte:');
        ChangeLabel('vf-form-title', 'Connexion avec votre compte Viafoura', 'Connexion avec votre compte');
        ChangeLabel('vf-form-title', 'Ã‰crivez votre courriel', 'Écrivez votre courriel');
        ChangeLabel('vf-link vf-forgot-password', 'Mot de passe oubliÃ©?', 'Mot de passe oublié?');
        ChangeLabel('vf-error-message', 'Incorrect password.', 'Mot de passe invalide.');
		ChangeLabel('vf-error-message', 'Incorrect login credentials.', 'Mot de passe invalide.');
		ChangeLabel('vf-error-message', 'Email required.', 'Adresse courriel obligatoire.');
		ChangeLabel('vf-error-message', 'You have been banned.', 'Votre compte est suspendu.');
        ChangeLabel('vf-error-message', 'Ne peut pas Ãªtre vide', 'Ne peut pas être vide');
        ChangeLabel('vf-error-message', '8 caractÃ¨res minimum', '8 caractères minimum');
        ChangeLabel('vf-link vf-login', 'Retourner Ã\&nbsp; la connexion', 'Retourner à la connexion');
        ChangeLabel('vf-success-message', 'Vous recevrez bientÃ´t un courriel.', 'Vous recevrez bientôt un courriel.');
        ReplaceLabel('vf-error-message', 'Password cannot be blank.', 'Le mot de passe ne peut être vide');
        ReplaceLabel('vf-error-message', 'Unregistered email address.', 'Adresse courriel invalide');
        ChangeLabel('vf-error-message', 'Retourner Ã\&nbsp; la connexion', 'Retourner à la connexion');
        ChangeLabel('vf-error-message', 'Email address already used by a different account.', 'Votre adresse courriel est déjà utilisée.');                                         
        ChangeLabel('vf-settings vf-is-selection', 'ParamÃ¨tres', 'Paramètres');
        ChangeLabel('vf-error-message', 'NÃ©cessaire lorsque vous modifiez un adresse courriel', 'Nécessaire lorsque vous modifiez un adresse courriel');
        ChangeLabel('vf-set-default-avatar', 'Utiliser l\'avatar par dÃ©faut', 'Utiliser l\'avatar par défaut');
        ChangeLabel('vf-success-message', 'Votre profil a Ã©tÃ© modifiÃ© avec succÃ¨s.', 'Votre profil a été modifié avec succès.');
        ReplaceLabel('vf-user-info vf-clearfix', 'AimÃ©s', 'Aimés');

        var commentBox = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-name-input');
        if (commentBox !== undefined && commentBox[0] !== undefined) {
            commentBox[0].setAttribute('placeholder', 'Votre nom complet');
        }

        ModifyResetPasswordWindow();
    },

    //35
    ModifyResetPasswordWindow = function () {
        var parent = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-password-retrieval");
        if (parent && parent[0]) {
            var selectorWarning = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowserScope(parent[0], "vf-form-actions");
            if (selectorWarning && selectorWarning[0]) {

                selectorWarning[0].innerHTML = selectorWarning[0].innerHTML.replace('Un nouveau mot de passe temporaire vous sera envoyé par courriel par notre partenaire Viafoura. Veuillez utiliser ce mot de passe pour vous connecter à nouveau. Nous vous conseillons de changer de mot de passe après votre connexion.<br><br>', '');
                selectorWarning[0].innerHTML = 'Un nouveau mot de passe temporaire vous sera envoyé par courriel par notre partenaire Viafoura. Veuillez utiliser ce mot de passe pour vous connecter à nouveau. Nous vous conseillons de changer de mot de passe après votre connexion.<br><br>' + selectorWarning[0].innerHTML;
            }
        }
    },

    //ModifySettingsWindow
    ModifySettingsWindow = function () {

        /*
        var parent = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-settings-container");
        if (parent && parent[0]) {
            var emailInput = document.getElementsByName("vf_email");
            if (emailInput && emailInput[0]) {
                emailInput[0].style.display = "none";
                emailInput[0].previousSibling.previousSibling.innerHTML = "";
            }
        }*/

        var parent = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-settings vf-is-selection");
        if (parent && parent[0]) {
            /*var emailInput = document.getElementsByName("vf_email");
            if (emailInput && emailInput[0]) {
                emailInput[0].style.display = "none";
                emailInput[0].previousSibling.previousSibling.innerHTML = "";
            }*/
            parent[0].style.display = "none";
        }

        
    },

    //36
    ModifySignupWindow = function () {
        var SignupContainer = GetElementsByClassNameCrossBrowser('vf-user-signup');


        if (SignupContainer) {
            var SignupTitle = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowserScope(SignupContainer[0], 'vf-form-title');

            if (SignupTitle) {
                SignupTitle[0].innerHTML = 'Créer un compte';
            }
        }

        ChangeLabel('vf-error-message', 'Email address already used by a different account.', 'Votre adresse courriel est déjà utilisée.');

        var signUpButton = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-submit-button");
        if (signUpButton && signUpButton[0] && signUpButton[0].value != "S'incrire") {
            signUpButton[0].value = "S'inscrire";
        }
    },

    //
    ModifyViafouraWidget = function () {
        VerifyCommentsListLoaded(function () {
            ModifyCommentsList();
        });

        ViafouraSignupPopupLoaded(function () {
            ModifySignupWindow();
        });

        ViafouraLoginPopupLoaded(function () {
            ModifyLoginWindow();
        });

        ViafouraSettingsPopupLoaded(function () {
            ModifySettingsWindow();
        });

    }

    //37
    Reload = function () {
        var session_id = '';
        var apiURL = '';
        if (window.viafoura && window.viafoura.session && window.viafoura.session.current().id) {
            session_id = window.viafoura.session.current().id;
            apiURL = viafouraApi + 'users/current?session=' + session_id;
        }
        else {
            apiURL = viafouraApi + 'users/current';
        }

        var callBackFunction = 'ReloadCallback';
        RadioCanada.Viafoura.J50Npi.getJSON(apiURL, {}, callBackFunction);
    },

    //38
    ReloadCallback = function (resultat) {
        RadioCanada.Viafoura.ViafouraUser.id = resultat.result.id;

        SetUserInfo(resultat);

        if (CommentsClose) {
            ShowCommentsClose('viafoura');
        }

        if (ViafouraOnline) {
            ModifyViafouraWidget();
        }

        WriteLoginStatus();

        if (typeof (LoginExternalCallback) == 'function') {
            LoginExternalCallback();
        }
    },

    //39
    ReplaceCommentSectionOption = function (commentOption, index, newText) {

        if (commentOption[0].options[index] !== undefined) {
            commentOption[0].options[index].innerHTML = newText;
        }
    },

    //40
    ReplaceLabel = function (className, oldText, newText) {
        var container = GetElementsByClassNameCrossBrowser(className);
        var containerIndex = 0;

        if (container !== undefined) {
            while (container[containerIndex] !== undefined) {
                container[containerIndex].innerHTML = container[containerIndex].innerHTML.replace(oldText, newText);;
                containerIndex++;
            }
        }
    },

    //41
    SaveCyberletter = function () {
        var mailingLists = new Array();
        document.getElementById('btSubmit').disabled = true;

        /*
        mailingLists[0] = "3";
        mailingLists[1] = "4";
        mailingLists[2] = "5";
        mailingLists[3] = "6";
        mailingLists[4] = "7";
        mailingLists[5] = "8";
        mailingLists[6] = "9";
        mailingLists[7] = "10";
        mailingLists[8] = "12";
        mailingLists[9] = "17";

        mailingLists[10] = "2";
        mailingLists[11] = "16";
        mailingLists[12] = "21";

        var query = "[";
        var SEP = "";
        var subscribe = "";
        for (i = 0; i < mailingLists.length; i++) {
            if (document.getElementById('cyberlettre-' + mailingLists[i])) {
                if (document.getElementById('cyberlettre-' + mailingLists[i]).checked == true) {
                    query += SEP + "{\"ID\":\"" + mailingLists[i] + "\", \"Name\":\"\", \"Subscribe\":\"1\"}";
                }
                else {
                    query += SEP + "{\"Id\":\"" + mailingLists[i] + "\", \"Name\":\"\", \"Subscribe\":\"0\"}";
                }
                SEP = ",";
            }
        }

        query += "]";
        */
        var query = "[";
        var SEP = "";
        var i = 0;
        var cyberlettreId;
        while (document.getElementById('keyValueCyberlettre-' + i)) {
            cyberlettreId = document.getElementById('keyValueCyberlettre-' + i).value;
            if (document.getElementById('cyberlettre-' + cyberlettreId).checked == true) {
                query += SEP + "{\"Id\":\"" + cyberlettreId + "\", \"Name\":\"\", \"Subscribe\":\"1\"}";
            }
            else {
                query += SEP + "{\"Id\":\"" + cyberlettreId + "\", \"Name\":\"\", \"Subscribe\":\"0\"}";
            }
            SEP = ",";
            i++;
        }

        query += "]";
        var callBackFunction = 'SaveCyberletterCallback';
        var apiURL = RadioCanada.Viafoura.path + '/Cyberlettre';
        var email = RadioCanada.Viafoura.ViafouraUser.email;
        //var langue = 'fr';
        var langue = '5';

        RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { action: "save", email: email, langue: langue, mailingLists: query, fctCallback: callBackFunction }, callBackFunction);
    },

    //42
	SaveCyberletterCallback = function () {
	    window.location.reload(true);
	},

    //
    SaveRciCyberletter = function () {


        if (document.getElementById('btnSubmit')) {
            document.getElementById('btnSubmit').disabled = true;
        }

        var email = '';

        if (document.getElementById('email_txt')) {
            email = document.getElementById('email_txt').value;
            document.getElementById('email').value = email;
        }

        var francais = false;
        if (document.getElementById('22')) {
            francais = document.getElementById('22').checked;
        }

        var anglais = false;
        if (document.getElementById('23')) {
            anglais = document.getElementById('23').checked;
        }

        var espagnol = false;
        if (document.getElementById('24')) {
            espagnol = document.getElementById('24').checked;
        }

        var chinois = false;
        if (document.getElementById('25')) {
            chinois = document.getElementById('25').checked;
        }

        var arabe = false;
        if (document.getElementById('26')) {
            arabe = document.getElementById('26').checked;
        }

        var query = "[";
        query += "{\"Id\":\"1\", \"Name\":\"\", \"Subscribe\":\"" + francais + "\"},";
        query += "{\"Id\":\"2\", \"Name\":\"\", \"Subscribe\":\"" + anglais + "\"},";
        query += "{\"Id\":\"3\", \"Name\":\"\", \"Subscribe\":\"" + espagnol + "\"},";
        query += "{\"Id\":\"4\", \"Name\":\"\", \"Subscribe\":\"" + chinois + "\"},";
        query += "{\"Id\":\"5\", \"Name\":\"\", \"Subscribe\":\"" + arabe + "\"}";
        query += "]";

        document.getElementById('mailingLists').value = query;

        var langue = GetUpakneeeLangue();
        document.getElementById('langue').value = langue;

        var callBackFunction = 'SaveRciCyberletterCallback';
        document.getElementById('fctCallback').value = callBackFunction;

        //var apiURL = RadioCanada.Viafoura.path + '/Cyberlettre';

        //RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { action: "saveRci", email: email, langue: langue, mailingLists: query, fctCallback: callBackFunction }, callBackFunction);        
        document.getElementById("rci").submit();
    },

    GetUpakneeeLangue = function () {
        var langue = 'fr';
        var url = window.location + '';
        var urlPart = url.split('/');
        var iLangue = 5;

        if (urlPart.length >= 4) {
            langue = urlPart[3];
        }

        switch (langue) {
            case 'fr':
                iLangue = 5;
                break;
            case 'en':
                iLangue = 6;
                break;
            case 'es':
                iLangue = 7;
                break;
            case 'ar':
                iLangue = 8;
                break;
            case 'zh':
                iLangue = 9;
                break;
        }
        return iLangue;
    },

    GetLangue = function () {
        var langue = 'fr';
        var url = window.location + '';
        var urlPart = url.split('/');

        if (urlPart.length >= 4) {
            langue = urlPart[3];
        }

        return langue;
    },

    SaveRciCyberletterCallback = function () {
        var langue = GetLangue();

        window.location = 'http://www.rcinet.ca/' + langue + '/cybermagazine/abonnement/';
    },

    //43
	Set_Cookie = function (name, value) {
	    path = '/';
	    domain = 'radio-canada.ca'
	    secondes = 24 * 60 * 60 * 1000 * 14; //2 semaines
	    var today = new Date();
	    today.setTime(today.getTime());
	    var expires = new Date(today.getTime() + (secondes));
	    var secure = "";


	    document.cookie = name + "=" + value +
		((expires) ? ";expires=" + expires.toGMTString() : "") +
		((path) ? ";path=" + path : "") +
		((domain) ? ";domain=" + domain : "") +
		((secure) ? ";secure" : "");
	},

    //
    SetUserInfo = function (resultat) {        
        //if (RadioCanada.Viafoura.ViafouraUser.id && RadioCanada.Viafoura.ViafouraUser.id != '0' || (resultat.result.id && resultat.result.id != '0')) {        
        if (resultat.result.id && resultat.result.id != '0') {
     
            if (!RadioCanada.Viafoura.ViafouraUser.logged) {                
                window.viafoura.reset();
            }
            RadioCanada.Viafoura.ViafouraUser.logged = true;
            RadioCanada.Viafoura.ViafouraUser.comments_made = resultat.result.comments_made;
            RadioCanada.Viafoura.ViafouraUser.name = resultat.result.name;
            RadioCanada.Viafoura.ViafouraUser.email = resultat.result.email;
            RadioCanada.Viafoura.ViafouraUser.user_privilege = resultat.result.user_privilege;
            RadioCanada.Viafoura.ViafouraUser.pic_small = resultat.result.pic_small;
            RadioCanada.Viafoura.ViafouraUser.postingBan = (resultat.result.ban_level == "posting");
            RadioCanada.Viafoura.ViafouraUser.postingBanReason = '';
        }
        else {
            RadioCanada.Viafoura.ViafouraUser.logged = false;
        }
    },

    //44
    ShowCenterMemberCloseMessage = function () {
        var MonProfil = document.getElementById('SSOMonProfil'),
		    html = "";

        html += '<!-- Version deconnecte ou non inscrit  -->';
        html += '<h1 class="profil"><span>Mon profil</span></h1>';

        html += '<style> .commentsClose{font-family: Arial,Helvetica,sans-serif; line-height: 20px; font-size: 14px;  background-color: #F6F6F6; border: 1px solid #D3D3D3; margin: 23px 0 21px; padding: 8px 20px 10px 16px;} </style><div class="commentsClose">Chers internautes, <br><br>' +
        'Nos tribunes de commentaires sont actuellement fermées pour permettre une mise à niveau.<br><br>' +
        'L\'équipe de ICI Radio-Canada.ca prévoit que les tribunes seront disponibles à partir de 17h00.<br><br>' +
        'Merci de votre patience et de votre fidélité!<br><br>' +
        'L\'équipe de ICI Radio-Canada.ca<br><br></div>';


        MonProfil.innerHTML = html;

    },

    //45
    ShowComments = function (articleID) {
        RadioCanada.Viafoura.IncludeCustomViafouraCss();

        var pluckDiv = document.getElementById('pluckComments-0');
        // Vérifier que le sélecteur existe

        if (pluckDiv) {
            var viafouraDiv = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("viafoura");

            if (!(viafouraDiv && viafouraDiv[0])) {
                RadioCanada.Viafoura.AddVfUniqueIdMetaTag(articleID);
                pluckDiv.innerHTML = '<div class="viafoura"><div class="vf-comments vf-widget" data-widget="comments" ></div></div>';
            }

            RadioCanada.Viafoura.IncludeViafouraScript();

            var loadInterval = setInterval(function () {
                if (window.viafoura) {
                    clearInterval(loadInterval);
                    InitEvents();
                }

                return;
            }, 100);
        }
    },

    //46
	ShowCommentsClose = function (divId) {
	    if (document.getElementById(divId) !== null) {
	        document.getElementById(divId).innerHTML = '<style> .commentsClose{font-family: Arial,Helvetica,sans-serif; line-height: 20px; font-size: 14px;  background-color: #F6F6F6; border: 1px solid #D3D3D3; margin: 10px 0 21px; padding: 8px 20px 10px 16px;} </style>' +
            '<img src="//s.radio-canada.ca/_img/logo/logo-nav-radio-canada.gif">' +
            '<div class="commentsClose" id="container-document"><b>Les tribunes d\'ICI Radio-Canada.ca font peau neuve</b><br><br>' +
	        'Les tribunes d\'ICI Radio-Canada.ca sont actuellement fermées pour permettre de grandes <i>rénovations</i> destinées à rendre votre expérience encore plus agréable.<br><br>' +
            'Revenez-nous dans les prochaines heures pour découvrir nos nouveaux espaces de commentaires. Entre-temps, vous pouvez consulter notre <a href="http://auditoire.radio-canada.ca/index.php?/Knowledgebase/List/Index/23/tribunes" target="_blank">Foire aux questions (FAQ)</a>.<br><br>' +
            'Quelques points à retenir:<br>' +
            '<ul><li>Vos nom d\'usager et mot de passe demeurent inchangés</li>' +
            '<li>Les commentaires publiés ces derniers mois seront transférés graduellement</li>' +
            '<li>La modération des commentaires se fera selon <a href="#" onclick="openPopup(\'http://www.radio-canada.ca/apropos/conditionsutilisation/netiquette/popUp.shtml\', 600,500, \'yes\'); return false;">les mêmes règles</a> </li></ul>' +
	        'Nous croyons que ce changement rendra votre expérience sur ICI Radio-Canada.ca encore plus intéressante et interactive.<br><br>' +
            'À plus tard!<br><br>' +
            'L\'équipe d\'ICI Radio-Canada.ca<br><br></div>';
	    }
	},

    //47
    ShowLoginForm = function () {
        // changement des liens des boutons 
        // Bouton "Se connecter" 
        var seConnecterElement = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("se_connecter");
        if (seConnecterElement && seConnecterElement[0]) {
            seConnecterElement[0].setAttribute("href", "#");
            //seConnecterElement[0].setAttribute("onclick", "rcOAuth2Client.login()");
            seConnecterElement[0].setAttribute("onclick", "window.loginApi.login()");            
        }

        var inscrivezVousElement = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("inscrivez_vous");
        if (inscrivezVousElement && inscrivezVousElement[0]) {
            inscrivezVousElement[0].setAttribute("href", "#");
            inscrivezVousElement[0].setAttribute("onclick", "window.viafoura.ui.signup.show()");
        }

        var offlineCustomerElement = document.getElementById('offline_customer');
        if (offlineCustomerElement) {
            offlineCustomerElement.style.display = "block";
        }

        var onlineCustomerElement = document.getElementById('online_customer');
        if (onlineCustomerElement) {
            onlineCustomerElement.style.display = "none";
        }
    },

    ShowMessageToLog = function () {
        if (RadioCanada.Viafoura.ViafouraUser.logged && RadioCanada.Viafoura.ViafouraUser.name != null) {
            var message = '<div class="connexionViafoura"><a href="http://ici.radio-canada.ca/mon-espace" target="_blank">' + ViafouraUser.name + '</a><!-- | <a href="#" onclick="rcOAuth2LoginBar.logout();">Déconnexion</a> --></div>';

            var comment = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-comment-box');

            if (comment != undefined && comment[0] != undefined) {
                comment[0].style.display = "block";
            }

            var connexion = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-login-widget');

            if (connexion != undefined && connexion[0] != undefined) {
                if (connexion[0].innerHTML != message) {
                    connexion[0].innerHTML = message;
                }
            }
        } else {
            //ICI il faudrait supprimer le cookie VfSess s'il existe.            
            //var message = '<div class="connexionViafoura"><a href="#" onclick="RadioCanada.Viafoura.LogOutLayer7()">Connexion</a> | <a href="#" onclick="rcOAuth2Client.login();">S\'inscrire</a></div>';
            var message = '<div class="connexionViafoura"><a href="#" onclick="RadioCanada.Viafoura.LogOutLayer7()">Connexion</a> | <a href="#" onclick="window.loginApi.createAccount();">S\'inscrire</a></div>';
            
            //var message = '<div class="connexionViafoura"><a href="#" onclick="rcOAuth2Client.login()">Connexion</a> | <a href="#" onclick="rcOAuth2Client.login();">S\'inscrire</a></div>';

            var comment = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-comment-box');

            if (comment != undefined && comment[0] != undefined) {                
                comment[0].style.display = "none";                
            }

            var connexion = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser('vf-login-widget');

            if (connexion != undefined && connexion[0] != undefined) {
                if (connexion[0].innerHTML != message) {
                    connexion[0].innerHTML = message;
                }
            }
        }
    },

    //48
	ShowNewsLetter = function () {
	    

	    document.getElementById('message').innerHTML = "Chargement en cours...";
	    document.getElementById('offline_customer').style.display = "none";	    
		var email = RadioCanada.Viafoura.ViafouraUser.email;
		
	    var callBackFunction = 'ShowNewsLetterCallback';
	    var apiURL = RadioCanada.Viafoura.path + '/Cyberlettre/';
	    var source = 'src';
	    var langue = 'fr';

	    RadioCanada.Viafoura.J50Npi.getJSON(apiURL, { action: "show", email: email, source: source, langue: langue, fctCallback: callBackFunction, t: Date.now() }, 'ShowNewsLetterCallback');
	},

    //49
	ShowNewsLetterCallback = function (resultat) {
	    document.getElementById('message').innerHTML = "";
	    /*
	    try {
	        var parsedResult = JSON.parse(resultat.Data[0]);
	    }
	    catch (err) {
	        alert('erreur dans le ShowNewsLetterCallback');
	    }
        */


	    var id = '';
	    var name = '';
	    var subscribe = '';
	    var liste = '';
	    var description = '';
	    var checked = '';
	    /*
	    for (i = 0; i < parsedResult.length; i++) {
	        id = parsedResult[i].ID;
	        name = parsedResult[i].Name;
	        subscribe = parsedResult[i].Subscribe;

	        if (subscribe == "1") {
	            if (document.getElementById('cyberlettre-' + id)) {
	                document.getElementById('cyberlettre-' + id).checked = true;
	            }
	        }
	    }*/
	    document.getElementById('listeCyberlettre').innerHTML = '<table class="tbl_DataUpdates">' +
                                    '<tbody>' +
                                        '<tr>' +
                                            '<th class="titreCyberlettre">Cyberlettres de ICI.radio-Canada.ca</th>' +
                                        '</tr>';
	    for (i = 0; i < resultat.Data.length; i++) {
	        id = resultat.Data[i].Id;
	        name = resultat.Data[i].DisplayName;
	        subscribe = resultat.Data[i].UserSubscribe;
	        description = resultat.Data[i].Description;


	        /*
	        if (subscribe == "1") {
	            if (document.getElementById('cyberlettre-' + id)) {
	                document.getElementById('cyberlettre-' + id).checked = true;
	            }
	        }
            */
	        if (subscribe) {
	            checked = ' checked ';
	        } else {
	            checked = '';
	        }
	        document.getElementById('listeCyberlettre').innerHTML +=
	                                    '<tr>' +
	                                        '<td>' +
	                                            '<p>' +
                                                    '<input type="hidden" id="keyValueCyberlettre-' + i + '" value="' + id + '">' +
	                                                '<input type="checkbox" class="chkb" id="cyberlettre-' + id + '" name="Cyberlettre' + id + '"' + checked + '><label for="Cyberlettre' + id + '">' +
                                                    '   <a href="javascript:toggleDescription(\'Cyberlettre' + id + '\')">' + name + '</a>' +
                                                    '</label><br>' +
                                                    '<span id="Cyberlettre' + id + '_desc" class="descriptor">' +
	                                                    description +
	                                                '</span>' +
	                                            '</p>' +
	                                        '</td>' +
	                                    '</tr>';
	    }

	    document.getElementById('listeCyberlettre').innerHTML += '<br><br><input type="button" class="td_BtnSave" id="btSubmit" value="Enregistrer les changements" name="btSubmit" onclick="RadioCanada.Viafoura.SaveCyberletter();">';

	    document.getElementById('online_customer').style.display = "block";
	},

    //50
    VerifyCommentsListLoaded = function (callback) {
        if (typeof (callback) !== "undefined") {
            //var selectorArticle = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-comment-thread");
            //var selectorProfile = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-list");
            var selectorProfile = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-commenting");

            //if (typeof (selectorArticle) !== "undefined" || typeof (selectorProfile) !== "undefined") {
            if (typeof (selectorProfile) !== "undefined") {
                if (RadioCanada.Viafoura.ModifyCommentsListCalled == false) {
                    callback();
                }
            } else {               
                RadioCanada.Viafoura.ModifyCommentsListCalled = false;
            }

            setTimeout(function () {
                RadioCanada.Viafoura.VerifyCommentsListLoaded(callback);
            }, 500);

        }
    },

    //51
    ViafouraLoginPopupLoaded = function (callback) {
        if (typeof (callback) !== "undefined") {
            var selector = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-user-login");
            if (typeof (RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("loginHeader")) !== "undefined") {
                RadioCanada.Viafoura.ViafouraLoginPopupCallbackCalled = false;
            }
            if (typeof (selector) !== "undefined") {
                if (RadioCanada.Viafoura.ViafouraLoginPopupCallbackCalled == false) {
                    //RadioCanada.Viafoura.ViafouraLoginPopupCallbackCalled = true;
                    callback();
                }
            } else {
                RadioCanada.Viafoura.ViafouraLoginPopupCallbackCalled = false;
            }

            setTimeout(function () {
                RadioCanada.Viafoura.ViafouraLoginPopupLoaded(callback);
            }, 250);
        }
    },

    //52
    ViafouraSignupPopupLoaded = function (callback) {

        if (typeof (callback) !== "undefined") {

            var selector = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-user-signup");
            if (typeof (RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("loginHeader")) !== "undefined") {
                RadioCanada.Viafoura.ViafouraSignupPopupCallbackCalled = false;
            }

            if (typeof (selector) !== "undefined") {
                if (RadioCanada.Viafoura.ViafouraSignupPopupCallbackCalled == false) {
                    //RadioCanada.Viafoura.ViafouraSignupPopupCallbackCalled = true;
                    callback();
                }
            } else {
                RadioCanada.Viafoura.ViafouraSignupPopupCallbackCalled = false;
            }

            setTimeout(function () {
                RadioCanada.Viafoura.ViafouraSignupPopupLoaded(callback);
            }, 250);
        }
    },

    ViafouraSettingsPopupLoaded = function (callback) {
        if (typeof (callback) !== "undefined") {

            var selector = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-user-profile");

            if (typeof (selector) !== "undefined") {
                if (RadioCanada.Viafoura.ViafouraSettingsPopupCallbackCalled == false) {
                    //RadioCanada.Viafoura.ViafouraSettingsPopupCallbackCalled = true;
                    callback();
                }
            } else {
                RadioCanada.Viafoura.ViafouraSettingsPopupCallbackCalled = false;
            }

            setTimeout(function () {
                RadioCanada.Viafoura.ViafouraSettingsPopupLoaded(callback);
            }, 250);
        }
    }

    //53
    WriteLoginStatus = function (Label) {
        var Label = null;
        if (RadioCanada.Viafoura.ViafouraUser.logged) {
            Label = RadioCanada.Viafoura.ViafouraUser.name;
        }

		ChangeLabel('vf-no-messages', 'There are no comments yet.', '');
		/*
		RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-rt-toggle vf-tip vf-rt-overlay-color-text active vf-rt-accent-color-background")[0].style.display = "none";
		RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-realtime vf-comments-realtime vf-rt-main-static")[0].style.display = "none";
		RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-realtime vf-comments-realtime vf-rt-main-sticky stuck")[0].style.display = "none";
		
		
		
		var tabRealtime = RadioCanada.Viafoura.GetElementsByClassNameCrossBrowser("vf-realtime vf-rt-reply");
		for (var i=0; i<tabRealtime.length; i++) 
		{
			tabRealtime[i].style.display = "none";
		}
		
		*/
		
		jQuery('.vf-reply-btn').prop('onclick', null).off('click');
		jQuery('.vf-flag').prop('onclick', null).off('click');
		jQuery('.vf-dislike-btn').prop('onclick', null).off('click');
		jQuery('.vf-new-like-btn').prop('onclick', null).off('click');
		jQuery('.vf-like-btn').prop('onclick', null).off('click');

        
        

		if (!RadioCanada.Viafoura.ViafouraUser.logged)
		{
		    jQuery('.vf-reply-btn').click(function (event) {		    
		        alert('Vous devez être connecté pour «Répondre»');
		    return false;
		    });

		    jQuery('.vf-flag').click(function (event) {
		        alert('Vous devez être connecté pour «Signaler»');
		        return false;
		    });

		    jQuery('.vf-dislike-btn').click(function (event) {
		        alert('Vous devez être connecté pour «Aimer»');
		        return false;
		    });

		    jQuery('.vf-new-like-btn').click(function (event) {
		        alert('Vous devez être connecté pour «Aimer»');
		        return false;
		    });

		    jQuery('.vf-like-btn').click(function (event) {
		        alert('Vous devez être connecté pour «Aimer»');
		        return false;
		    });            
		}

        if (memberCenterClose) {
            if (document.getElementById("src-nav-login")) {
                document.getElementById("src-nav-login").innerHTML = ('<div id="not-connected"><a title="Me connecter" href="http://www.radio-canada.ca/mesabonnements/mon_profil/index_close.shtml">Me connecter</a></div>');
            }
        }
        else {
            if (RadioCanada.Viafoura.ViafouraOnline) {
                if (document.getElementById("src-nav-login")) {
                    if (RadioCanada.Viafoura.ViafouraUser.logged) {
                        document.getElementById("src-nav-login").innerHTML = ('<div id="connected"><div>ICI <a style="color:#000; text-transform:uppercase; font-size:12px" href="#" onclick="window.viafoura.ui.profile.show(); return false;">' + Label + '</a></div><a title="Me déconnecter" href="#" onclick="window.viafoura.session.logout(); statsToClics(\'clic_action\',\'NavBar_Rouge_SeDeconnecter\',\'clic_contenu\',\'NavBar_Rouge_SeDeconnecter\',\'WT.ti\',\'NavBar_Rouge_SeDeconnecter\')">[Déconnexion]</a></div>');
                    } else {
                        document.getElementById("src-nav-login").innerHTML = ('<div id="not-connected"><a title="Me connecter" href="#" onclick="window.viafoura.ui.login.show(); statsToClics(\'clic_action\',\'NavBar_Rouge_SeConnecter\',\'clic_contenu\',\'NavBar_Rouge_SeConnecter\',\'WT.ti\',\'NavBar_Rouge_SeConnecter\')">Me connecter</a></div>');
                    }
                }
                    /*
                else {
                    if (!document.getElementById("src-nav-login")) {
                        
                    }
                }*/
            }
            else {
                if (document.getElementById("src-nav-login")) {
                    if (RadioCanada.Viafoura.ViafouraUser.logged) {
                        document.getElementById("src-nav-login").innerHTML = ('<div id="connected"><div>ICI ' + Label + '</div><a title="Me déconnecter" href="https://mesabonnements.radio-canada.ca/logout.aspx?redirecturl=http://ici.radio-canada.ca/" onclick="statsToClics(\'clic_action\',\'NavBar_Rouge_SeDeconnecter\',\'clic_contenu\',\'NavBar_Rouge_SeDeconnecter\',\'WT.ti\',\'NavBar_Rouge_SeDeconnecter\')">[Déconnexion]</a></div>');
                    } else {
                        document.getElementById("src-nav-login").innerHTML = ('<div id="not-connected"><a title="Me connecter" href="https://inscription.radio-canada.ca/SSOAuthenticationDomain.ashx?mode=login&redirecturl=http://ici.radio-canada.ca/" onclick="statsToClics(\'clic_action\',\'NavBar_Rouge_SeConnecter\',\'clic_contenu\',\'NavBar_Rouge_SeConnecter\',\'WT.ti\',\'NavBar_Rouge_SeConnecter\')">Me connecter</a></div>');
                    }
                }
            }
        }

        setTimeout(function () {
            RadioCanada.Viafoura.WriteLoginStatus();
        }, 500);
    };

    DebugInfoUser = function()
    {
        console.log('dans le DebugInfoUser');
        console.log(JSON.stringify(ViafouraUser));
        console.log('VfSess: ' + getCookie('VfSess'));
    }

    return {

        BunkerNavBarLogOn: BunkerNavBarLogOn,
        BunkerNavBarLogOut: BunkerNavBarLogOut,
        Get_Cookie: Get_Cookie,
        path: path,
        IncludeViafouraScript: IncludeViafouraScript,
        InitEvents: InitEvents,
        Init: Init,
        LoadNewsletter: LoadNewsletter,
        ShowCenterMemberCloseMessage: ShowCenterMemberCloseMessage,
        ShowNewsLetterCallback: ShowNewsLetterCallback,
        ShowCommentsClose: ShowCommentsClose,
        SaveCyberletter: SaveCyberletter,
        SaveCyberletterCallback: SaveCyberletterCallback,
        SaveRciCyberletter: SaveRciCyberletter,
        SaveRciCyberletterCallback: SaveRciCyberletterCallback,
        WriteLoginStatus: WriteLoginStatus,
        AutomaticSetup: AutomaticSetup,
        DrawMonProfil: DrawMonProfil,
        ContentMonProfil: ContentMonProfil,
        ModifySignupWindow: ModifySignupWindow,
        ModifyResetPasswordWindow: ModifyResetPasswordWindow,
        AddVfUniqueIdMetaTag: AddVfUniqueIdMetaTag,
        CommentsClose: CommentsClose,
        GetElementsByClassNameCrossBrowser: GetElementsByClassNameCrossBrowser,
        GetElementsByClassNameCrossBrowserScope: GetElementsByClassNameCrossBrowserScope,
        IncludeCustomViafouraCss: IncludeCustomViafouraCss,
        ViafouraSignupPopupCallbackCalled: ViafouraSignupPopupCallbackCalled,
        ViafouraSettingsPopupLoaded: ViafouraSettingsPopupLoaded,
        ViafouraSignupPopupLoaded: ViafouraSignupPopupLoaded,
        memberCenterClose: memberCenterClose,
        CheckIfMetaExists: CheckIfMetaExists,
        memberCenterClose: memberCenterClose,
        CreateMetaTag: CreateMetaTag,
        ModifyCommentsList: ModifyCommentsList,
        ModifyCommentsListCalled: ModifyCommentsListCalled,
        VerifyCommentsListLoaded: VerifyCommentsListLoaded,
        AppendCustomViafouraCss: AppendCustomViafouraCss,
        ViafouraOnline: ViafouraOnline,
        J50Npi: J50Npi,
        DeleteOptionWithValue: DeleteOptionWithValue,
        ShowLoginForm: ShowLoginForm,
        CheckIfViafouraScriptIsIncluded: CheckIfViafouraScriptIsIncluded,
        ViafouraLoginPopupLoaded: ViafouraLoginPopupLoaded,
        ModifyLoginWindow: ModifyLoginWindow,
        Instruction: Instruction,
        LogCall: LogCall,
        InitCallback: InitCallback,
        ViafouraUser: ViafouraUser,
        ReloadCallback: ReloadCallback,
        ShowComments: ShowComments,
        GetUpakneeUserId: GetUpakneeUserId,
        GetUpakneeUserIdCallback: GetUpakneeUserIdCallback,
        GetLangue: GetLangue,
        GetUpakneeeLangue: GetUpakneeeLangue,
        ModifySettingsWindow: ModifySettingsWindow,
        ShowMessageToLog: ShowMessageToLog,
        BlockBannedUser: BlockBannedUser,
        LoadWidget: LoadWidget,
        ShowNewsLetter: ShowNewsLetter,
        DebugInfoUser: DebugInfoUser,
        LogOutLayer7: LogOutLayer7,
        ManualyLoadCommentsWidget: ManualyLoadCommentsWidget,
        CallbackAfterViafouraReady: CallbackAfterViafouraReady,
		ResendConfirmationEmail: ResendConfirmationEmail
    };
}();
/*
document.addEventListener("DOMContentLoaded", function (event) {
   RadioCanada.Viafoura.Init();
});
*/
RadioCanada.Lib.Mod.oLoginStatus = {

    initLoginStatus: function () {

        if (RadioCanada.Viafoura.ViafouraUser.logged) {
            this.Label = RadioCanada.Viafoura.ViafouraUser.name;
        } else { this.Label = null; return; }
    },
    writeLoginStatus: function () {
        //WriteLoginStatus(this.Label);
    }
}

// Fichier utilisant les mêmes fonctions que Pluck, mais avec le widget de Viafoura 
// Version 1.0.9 
