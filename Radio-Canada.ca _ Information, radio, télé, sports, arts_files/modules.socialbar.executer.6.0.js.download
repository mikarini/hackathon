var RadioCanada=RadioCanada||{};RadioCanada.SocialBar=function(){var popup;var PluckCountResponseCall=null;var _pluckReady=false;var Title="";var Url="";var SocialBarId="";var WebTrendTwitterAction="";var host="https://api.radio-canada.ca/partage/v2/";var SocialBarInitialized=new Array();OpenPopup=function(url,width,height){popup=window.open(url,"name","height="+height+", width="+width);if(window.focus){popup.focus();}return false;},ResizeText=function(id,p_taille){LID=id;var cookie=getCookie("srcTailleTexte");if(!cookie){cookie="";}switch(cookie){case"":SetSizeStyleSheet("T1");break;case"0":SetSizeStyleSheet("T1");break;case"T1":SetSizeStyleSheet("T2");break;case"T2":SetSizeStyleSheet("0");break;default:SetSizeStyleSheet("0");}},SetSizeStyleSheet=function(size){if(size=="0"){SetDisableStyleSheet("Taille 1",true);SetDisableStyleSheet("Taille 2",true);if(document.getElementById("toggleText"+LID)){document.getElementById("toggleText"+LID).setAttribute("class","tailleText ttPlus");document.getElementById("toggleText"+LID).setAttribute("href","javascript:RadioCanada.SocialBar.ResizeText('"+LID+"','plus');");}}else{if(size=="T1"){SetDisableStyleSheet("Taille 1",false);SetDisableStyleSheet("Taille 2",true);}else{if(size=="T2"){SetDisableStyleSheet("Taille 1",true);SetDisableStyleSheet("Taille 2",false);if(document.getElementById("toggleText"+LID)){document.getElementById("toggleText"+LID).setAttribute("class","tailleText ttMoins");document.getElementById("toggleText"+LID).setAttribute("href","javascript:RadioCanada.SocialBar.ResizeText('"+LID+"','moins');");}}}}document.cookie="srcTailleTexte="+size;};SetDisableStyleSheet=function(title,val){var i,a,main;for(i=0;(a=document.getElementsByTagName("link")[i]);i++){if(a.getAttribute("rel").indexOf("style")!=-1&&a.getAttribute("title")){if(a.getAttribute("title")==title){a.disabled=val;}}}};SendWebTrendStats=function(url,title,action){if(title==""){title=url;}var metaClic=jQuery("meta[name='WT.clic']");var clic="";if(metaClic!=null&&metaClic.length>0){clic=metaClic[0].getAttribute("content");}var contenu=title;var ti=action+"_"+contenu;statsToClics("WT.clic",clic,"clic_action",action,"clic_contenu",contenu,"WT.ti",ti);},SendTwitterStats=function(url,title){if(title==""){title=url;}var metaClic=jQuery("meta[name='WT.clic']");var clic="";if(metaClic!=null&&metaClic.length>0){clic=metaClic[0].getAttribute("content");}var action=RadioCanada.SocialBar.WebTrendTwitterAction;var contenu=title;var ti=action+"_"+contenu;statsToClics("WT.clic",clic,"clic_action",action,"clic_contenu",contenu,"WT.ti",ti);};SetParameter=function(param){if(param.url==null){var url="";}else{var url=param.url;}if(param.articleId==null){var articleId="";}else{var articleId=param.articleId;}if(param.title==null){var title="";}else{var title=param.title;}if(param.socialBarId==null){var socialBarId="";}else{var socialBarId=param.socialBarId;}if(param.showPluck==null){var showPluck=false;}else{var showPluck=param.showPluck;}if(param.showMiniPluck==null){var showMiniPluck=false;}else{var showMiniPluck=param.showMiniPluck;}if(param.showViafoura==null){var showViafoura=false;}else{var showViafoura=param.showViafoura;}if(param.showMiniViafoura==null){var showMiniViafoura=false;}else{var showMiniViafoura=param.showMiniViafoura;}if(param.showMailSharing==null){var showMailSharing=false;}else{var showMailSharing=param.showMailSharing;}if(param.showFacebook==null){var showFacebook=true;}else{var showFacebook=param.showFacebook;}if(param.showTwitter==null){var showTwitter=true;}else{var showTwitter=param.showTwitter;}if(param.showGooglePlus==null){var showGooglePlus=true;}else{var showGooglePlus=param.showGooglePlus;}if(param.showPinterest==null){var showPinterest=false;}else{var showPinterest=param.showPinterest;}if(param.showLinkedIn==null){var showLinkedIn=true;}else{var showLinkedIn=param.showLinkedIn;}if(param.showShareCount==null){var showShareCount=true;}else{var showShareCount=param.showShareCount;}if(param.width==null){var width=300;}else{var width=param.width;}if(param.thumbnail==null){var thumbnail="";}else{var thumbnail=param.thumbnail;}if(param.summary==null){var summary="";}else{var summary=param.summary;}if(param.webTrendStatsToClic==null||param.webTrendStatsToClic==""){var webTrendStatsToClic=true;}else{var webTrendStatsToClic=param.webTrendStatsToClic;}if(param.webTrendEmailAction==null){var webTrendEmailAction="partage-courriel";}else{var webTrendEmailAction=param.webTrendEmailAction;}if(param.webTrendGooglePlusAction==null){var webTrendGooglePlusAction="partage-google";}else{var webTrendGooglePlusAction=param.webTrendGooglePlusAction;}if(param.webTrendFacebookAction==null){var webTrendFacebookAction="partage-facebook";}else{var webTrendFacebookAction=param.webTrendFacebookAction;}if(param.webTrendTwitterAction==null){var webTrendTwitterAction="partage-twitter";}else{var webTrendTwitterAction=param.webTrendTwitterAction;}if(param.webTrendIconPlusAction==null){var webTrendIconPlusAction="partage-bouton-plus";}else{var webTrendIconPlusAction=param.webTrendIconPlusAction;}if(param.webTrendStatsContent==null){var webTrendStatsContent="";}else{var webTrendStatsContent=param.webTrendStatsContent;}if(param.fullSocialBar==null){var fullSocialBar=true;}else{var fullSocialBar=param.fullSocialBar;}if(param.showResizeText==null){var showResizeText=false;}else{var showResizeText=param.showResizeText;}if(param.showPrint==null){var showPrint=false;}else{var showPrint=param.showPrint;}if(param.facebookCompleteStats==null){var facebookCompleteStats=true;}else{var facebookCompleteStats=param.facebookCompleteStats;}if(param.twitterAccount==null){var twitterAccount="";}else{var twitterAccount=param.twitterAccount;}if(param.darkStyle==null){var darkStyle=false;}else{var darkStyle=param.darkStyle;}if(param.biggerStyle==null){var biggerStyle=false;}else{var biggerStyle=param.biggerStyle;}if(param.compactSocialBar==null){var compactSocialBar=false;}else{var compactSocialBar=param.compactSocialBar;}if(param.popupWidth==null){var popupWidth=558;}else{var popupWidth=param.popupWidth;}if(param.popupHeight==null){var popupHeight=558;}else{var popupHeight=param.popupHeight;}if(param.verticalSocialBar==null){var verticalSocialBar=false;}else{var verticalSocialBar=param.verticalSocialBar;}if(param.emailBody==null){var emailBody="";}else{var emailBody=param.emailBody;}summary=summary.substring(0,200);summary=strip(summary);title=strip(title);webTrendEmailAction=strip(webTrendEmailAction);webTrendGooglePlusAction=strip(webTrendGooglePlusAction);webTrendFacebookAction=strip(webTrendFacebookAction);webTrendTwitterAction=strip(webTrendTwitterAction);webTrendIconPlusAction=strip(webTrendIconPlusAction);webTrendStatsContent=strip(webTrendStatsContent);try{title=decodeURIComponent(title);}catch(err){}var currentCall='{"url":"'+url+'",';currentCall+='"articleId":"'+encodeURIComponent(articleId)+'",';currentCall+='"title":"'+encodeURIComponent(title)+'",';currentCall+='"socialBarId":"'+encodeURIComponent(socialBarId)+'",';currentCall+='"showPluck":'+showPluck+",";currentCall+='"showMiniPluck":'+showMiniPluck+",";currentCall+='"showViafoura":'+showViafoura+",";currentCall+='"showMiniViafoura":'+showMiniViafoura+",";currentCall+='"showMailSharing":'+showMailSharing+",";currentCall+='"showFacebook":'+showFacebook+",";currentCall+='"showTwitter":'+showTwitter+",";currentCall+='"showGooglePlus":'+showGooglePlus+",";currentCall+='"showPinterest":'+showPinterest+",";currentCall+='"showLinkedIn":'+showLinkedIn+",";currentCall+='"showShareCount":'+showShareCount+",";currentCall+='"width":"'+width+'",';currentCall+='"thumbnail":"'+encodeURIComponent(thumbnail)+'",';currentCall+='"summary":"'+encodeURIComponent(summary)+'",';currentCall+='"webTrendStatsToClic":'+webTrendStatsToClic+",";currentCall+='"webTrendEmailAction":"'+encodeURIComponent(webTrendEmailAction)+'",';currentCall+='"webTrendGooglePlusAction":"'+encodeURIComponent(webTrendGooglePlusAction)+'",';currentCall+='"webTrendFacebookAction":"'+encodeURIComponent(webTrendFacebookAction)+'",';currentCall+='"webTrendTwitterAction":"'+encodeURIComponent(webTrendTwitterAction)+'",';currentCall+='"webTrendIconPlusAction":"'+encodeURIComponent(webTrendIconPlusAction)+'",';currentCall+='"webTrendStatsContent":"'+encodeURIComponent(webTrendStatsContent)+'",';currentCall+='"fullSocialBar":'+fullSocialBar+",";currentCall+='"showResizeText":'+showResizeText+",";currentCall+='"showPrint":'+showPrint+",";currentCall+='"facebookCompleteStats":'+facebookCompleteStats+",";currentCall+='"twitterAccount":"'+twitterAccount+'",';currentCall+='"darkStyle":'+darkStyle+",";currentCall+='"biggerStyle":'+biggerStyle+",";currentCall+='"compactSocialBar":'+compactSocialBar+",";currentCall+='"popupWidth":"'+popupWidth+'",';currentCall+='"popupHeight":"'+popupHeight+'",';currentCall+='"verticalSocialBar":'+verticalSocialBar+",";currentCall+='"emailBody":"'+emailBody+'"}';return currentCall;},GetApiUrl=function(jsonParameter){var parameters=jsonParameter;var urlLimit=1000;var currentCall="";var batchCalls="";var allCalls=new Array();if(!Array.isArray(parameters)){var action="SharingBar/ScriptSharingBarBatch?parametres=[";currentCall=SetParameter(parameters);var batchCalls=RadioCanada.SocialBar.host+action+currentCall;allCalls[allCalls.length]=batchCalls+"]";}else{var action="SharingBar/ScriptSharingBarBatch?parametres=[";var batchCalls=RadioCanada.SocialBar.host+action;var SEP="";parameters.forEach(function(param){currentCall=SetParameter(param);if((batchCalls+currentCall).length<urlLimit){batchCalls+=SEP+currentCall;SEP=",";}else{allCalls[allCalls.length]=batchCalls+"]";batchCalls=RadioCanada.SocialBar.host+action+currentCall;SEP=",";}});allCalls[allCalls.length]=batchCalls+"]";}return allCalls;},GetPostParam=function(jsonParameter){var parameters=jsonParameter;var urlLimit=10000;var currentCall="";var batchCalls="";var allCalls=new Array();if(!Array.isArray(parameters)){var tab=parameters;parameters=new Array(tab);}var postParam="[";var SEP="";parameters.forEach(function(param){postParam+=SEP+SetParameter(param);SEP=",";});postParam+="]";return postParam;},ShowSocialBar=function(parameters){var apiUrl=GetApiUrl(parameters);if(Array.isArray(apiUrl)&&apiUrl.length>1){var url=RadioCanada.SocialBar.host+"SharingBar/ScriptSharingBarBatch";jQuery.ajax({type:"POST",url:url,data:{parametres:GetPostParam(parameters)},cache:false,success:function(data){eval(data);},error:function(data){}});}else{var apiCall=apiUrl[0];jQuery.getScript(apiCall,function(data,textStatus,jqxhr){});}},strip=function(html){html=html.replace('"','"');var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||"";},ActionListShare=function(id){if(SocialBarInitialized[id]==undefined||!SocialBarInitialized[id]==false){var activeListShare="Afficher la liste complète des options de partage";var biggerText="Augmenter la taille du texte";var smallerText="Réduire la taille du texte";jQuery("#"+id+" .list-share > button").attr("title",activeListShare);jQuery("#"+id+" .list-tool .icon-font-size").attr("title",biggerText);jQuery("#"+id+" .icon-plus").click(function(){jQuery(this).parents(".src-socialbar").toggleClass("open-list-share");jQuery("body, html").toggleClass("open-socialbar");jQuery(this).parents(".src-socialbar").not(".lightbox").find(".list-share li:nth-child(3) button").focus();jQuery(this).parents(".src-socialbar.lightbox").find(".list-share li:first-child button").focus();if(jQuery(this).hasClass("icon-plus")){jQuery(this).removeClass("icon-plus").addClass("icon-minus").text("Moins").attr("title","Revenir à l'affichage initial");if(window.matchMedia("(max-width: 767px)").matches){jQuery(".open-socialbar").find("button, a, select, input").not(".open-list-share *").addClass("off").attr("tabindex","-1");}}else{jQuery(this).removeClass("icon-minus").addClass("icon-plus").text("Plus").attr("title",activeListShare);if(window.matchMedia("(max-width: 767px)").matches){jQuery(".off").removeClass("off").removeAttr("tabindex");}}if(window.matchMedia("(max-width: 767px)").matches){if(jQuery("body").hasClass("open-socialbar")){jQuery("body").bind("touchmove",function(e){e.preventDefault();});}else{jQuery("body").unbind("touchmove");}}});jQuery("#"+id+".src-socialbar").find(".list-share ul li button").click(function(){jQuery("body, html").removeClass("open-socialbar");jQuery(this).parents(".src-socialbar").removeClass("open-list-share");jQuery("#"+id+" .list-share > button").removeClass("icon-minus").addClass("icon-plus");});jQuery("#"+id+".icon-font-size").click(function(){if(jQuery(this).hasClass("small")){jQuery(this).removeClass("small").text(biggerText).attr("title",biggerText);}else{jQuery(this).addClass("small").text(smallerText).attr("title",smallerText);}});SocialBarInitialized[id]=true;}else{}},SendPlusButtonEvent=function(element){if(element.className=="icon-minus"){var event=new Event("social-bar-reduce");window.dispatchEvent(event);}};TriggerShowComments=function(ArticleUrl){try{window.RC.Bunker.SocialBar.SocialbarShowComments(ArticleUrl);}catch(err){window.location=ArticleUrl;}};return{OpenPopup:OpenPopup,Title:Title,Url:Url,WebTrendTwitterAction:WebTrendTwitterAction,GetApiUrl:GetApiUrl,SocialBarId:SocialBarId,host:host,ResizeText:ResizeText,SendWebTrendStats:SendWebTrendStats,ActionListShare:ActionListShare,ShowSocialBar:ShowSocialBar,TriggerShowComments:TriggerShowComments,SendPlusButtonEvent:SendPlusButtonEvent};}();function doShare(g,h,f,d,b,e,a){var c=h.replace("@@url@@",e);if(a||navigator.appVersion.indexOf("MSIE")!=-1){c=c.replace("@@titre@@",escape(b));}else{c=c.replace("@@titre@@",b);}window.open(c,"partage","toolbar=no,directories=no,status=no,menubar=no,scrollbars=yes,history=no,resizable=yes,width="+f+",height="+d);}