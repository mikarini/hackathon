var RadioCanada=RadioCanada||{};RadioCanada.DTM=RadioCanada.DTM||{};RadioCanada.DTM.Unit=RadioCanada.DTM.Unit||{};RadioCanada.DTM.Unit.Lotame=RadioCanada.DTM.Unit.Lotame||{};RadioCanada.DTM.Unit.Lotame=function(){var o=0;var v=30;var q=500;var p="";var A="";var t="";var w=0;var z=0;var x=0;var y=0;var s=false;var u=null;var r="RC_CFA_GEO_INFO";var B="radio-canada.ca";SendGeoInfo=function(){w=Get_Cookie("RC_CDM_REGION");z=Get_Cookie("RC_CDM_REGION_TELE");x=Get_Cookie("RC_CDM_REGION_MUSIQUE");y=Get_Cookie("RC_CDM_REGION_PREMIERE");w=w===undefined?0:w;z=z===undefined?0:z;x=x===undefined?0:x;y=y===undefined?0:y;if(GeoIpAvailable()){p=geoip_postal_code();A=geoip_city();t=geoip_region_name();RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","fsa : "+p);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","geoCity : "+A);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","geoRegion : "+t);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionEdition : "+w);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionTele : "+z);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionMusique : "+x);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionPremiere : "+y);s=true;UpdateGeoInfoInDataLayer(p,A,t);UpdateGeoInfoInCookie(p,A,t)}else{var b=GetUserInfoFromDataLayer();if(!FsaCodeValid(b.fsa)){b.fsa=GetGeoInfoFromCookie("fsa");b.city=GetGeoInfoFromCookie("city");b.geoRegion=GetGeoInfoFromCookie("region")}if(FsaCodeValid(b.fsa)){RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","fsa : "+b.fsa);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","geoCity : "+b.city);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","geoRegion : "+b.geoRegion);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionEdition : "+w);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionTele : "+z);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionMusique : "+x);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionPremiere : "+y);s=true}var a=setInterval(function(){if(GeoIpAvailable()){p=geoip_postal_code();A=geoip_city();t=geoip_region_name();if(!s){RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","fsa : "+p);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","geoCity : "+A);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionEdition : "+w);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionTele : "+z);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionMusique : "+x);RadioCanada.DTM.Unit.Lotame.LotameApi.add("geo","userRegionPremiere : "+y);RadioCanada.DTM.Unit.Lotame.LotameApi.bcpw("geo","geoRegion : "+t)}UpdateGeoInfoInDataLayer(p,A,t);UpdateGeoInfoInCookie(p,A,t);clearInterval(a)}o++;if(o>=v){clearInterval(a)}},q)}};FsaCodeValid=function(a){return(a!=""&&a!=undefined)};GeoIpAvailable=function(){return(typeof(geoip_postal_code)!="undefined")};GetUserInfoFromDataLayer=function(){if(typeof(dataLayerHelper)!="undefined"&&dataLayerHelper.get("user")!=undefined&&dataLayerHelper.get("user")!=undefined){return dataLayerHelper.get("user")}else{return{user:{fsa:"",city:"",region:""}}}};GetGeoInfoFromCookie=function(b){try{if(Get_Cookie(r)!=undefined){var c=JSON.parse(Get_Cookie(r)).user;return c[b]}}catch(a){return""}};UpdateGeoInfoInDataLayer=function(b,a,c){if(typeof(dataLayerQueue)!="undefined"){dataLayerQueue.push({user:{fsa:b,city:a,region:c}})}};UpdateGeoInfoInCookie=function(b,a,c){return Set_Cookie(r,'{"user":{"fsa":"'+b+'", "city": "'+a+'", "region": "'+c+'"}}')};Get_Cookie=function(b){var c,d,e,a=document.cookie.split(";");for(c=0;c<a.length;c++){d=a[c].substr(0,a[c].indexOf("="));e=a[c].substr(a[c].indexOf("=")+1);d=d.replace(/^\s+|\s+$/g,"");if(d==b){return unescape(e)}}};Set_Cookie=function(b,e){path="/";domain=B;secondes=24*60*60*1000*14;var d=new Date();d.setTime(d.getTime());var a=new Date(d.getTime()+(secondes));var c="";document.cookie=b+"="+e+((a)?";expires="+a.toGMTString():"")+((path)?";path="+path:"")+((domain)?";domain="+domain:"")+((c)?";secure":"")};return{SendGeoInfo:SendGeoInfo,LotameApi:u}}();var LotameDetectionInterval=500;var CptTry=0;var MaxTry=20;var boucle=setInterval(function(){if(LotameScriptLoaded()){RadioCanada.DTM.Unit.Lotame.LotameApi=_cc10664;RadioCanada.DTM.Unit.Lotame.SendGeoInfo();clearInterval(boucle)}else{if(CptTry>=MaxTry){clearInterval(boucle)}CptTry++;console.log("try #"+CptTry+" pour le script de Lotame")}},LotameDetectionInterval);function LotameScriptLoaded(){return(typeof(_cc10664)!="undefined")};